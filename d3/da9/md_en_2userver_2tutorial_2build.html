<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <!-- Yandex.Metrika counter -->
      <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(94541714, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
      </script>
      <noscript><div><img src="https://mc.yandex.ru/watch/94541714" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
      <!-- /Yandex.Metrika counter -->
      <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=9"/>
      <meta name="generator" content="Doxygen 1.10.0"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:image" content="../../logo_in_circle.png"/>
      <meta property="og:image:alt" content="userver logo"/>
      <link rel="icon" href="../../favicon.svg">
      <title>userver: Configure, Build and Install</title>
      <!-- Roboto fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <!-- Roboto fonts -->
      <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="../../jquery.js"></script>
      <!-- Highlight.js -->
      <link rel="stylesheet" href="../../highlightjs.css">
      <script src="../../highlight.min.js"></script>
      <!-- Highlight.js -->
      <!-- Roboto fonts -->
      <script type="text/javascript" src="../../dynsections.js"></script>
      <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
      <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
      <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
      <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
      <link rel="stylesheet" href="../../customdoxygen.css">
      <!-- Doxygen Awesome -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
      <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
        DoxygenAwesomeParagraphLink.init()
        DoxygenAwesomeInteractiveToc.topOffset = 180;
      </script>
      <!-- Doxygen Awesome -->
    </head>
    <body>
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0" style="width: 100%;">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
                <td id="projectalign">
                  <div id="projectname">
                    <a class="titlelink" href="../../index.html">userver
                    </a>
                  </div>
                  <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework</a></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d3/da9/md_en_2userver_2tutorial_2build.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Configure, Build and Install</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md596"></a> </p>
<h1><a class="anchor" id="autotoc_md597"></a>
Quick start for beginners</h1>
<p>1. clone service template and userver repositories</p>
<div class="fragment"><div class="line">git clone --depth 1 https://github.com/userver-framework/service_template.git &amp;&amp; \</div>
<div class="line">git clone --depth 1 https://github.com/userver-framework/userver.git service_template/third_party/userver &amp;&amp; \</div>
<div class="line">cd service_template</div>
</div><!-- fragment --><p>More information about the service template can be found here: <a class="el" href="../../da/d16/md_en_2userver_2tutorial_2hello__service.html">Writing your first HTTP server</a></p>
<p>2. install build dependencies for userver</p>
<p>see build dependencies here: <a class="el" href="#service_templates">service_templates</a></p>
<p>for example to install <a class="el" href="#ubuntu_22_04">ubuntu_22_04</a> build dependencies:</p>
<div class="fragment"><div class="line">sudo apt update &amp;&amp; \</div>
<div class="line">sudo apt install --allow-downgrades -y $(cat third_party/userver/scripts/docs/en/deps/ubuntu-22.04.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><p>3. build and start hello service</p>
<div class="fragment"><div class="line">make build-release &amp;&amp; \</div>
<div class="line">make service-start-release</div>
</div><!-- fragment --><p>During the build, you can make a coffee break until approximately the following output appears:</p>
<div class="fragment"><div class="line">====================================================================================================</div>
<div class="line">Started service at http://localhost:8080/, configured monitor URL is http://localhost:-1/</div>
<div class="line">====================================================================================================</div>
<div class="line"> </div>
<div class="line">PASSED</div>
<div class="line">[service-runner] Service started, use C-c to terminate</div>
<div class="line">INFO     &lt;userver&gt; Server is started</div>
<div class="line">...</div>
<div class="line">DEBUG    &lt;userver&gt; Accepted connection #2/32768</div>
<div class="line">DEBUG    &lt;userver&gt; Incoming connection from ::ffff:127.0.0.1, fd 43</div>
</div><!-- fragment --><p>4. try to send request</p>
<div class="fragment"><div class="line">curl http://127.0.0.1:8080/hello?name=userver</div>
</div><!-- fragment --><p>The answer should be something like this:</p>
<div class="fragment"><div class="line">&gt; curl http://127.0.0.1:8080/hello?name=userver</div>
<div class="line">Hello, userver!</div>
</div><!-- fragment --><p>5. Now you are ready for fast and comfortable creation of C++ microservices, services and utilities!</p>
<h1><a class="anchor" id="autotoc_md598"></a>
CMake options</h1>
<p>The following CMake options are used by userver:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Default    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_CORE   </td><td class="markdownTableBodyNone">Provide a core library with coroutines, otherwise build only <code>userver::universal</code>   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_MONGODB   </td><td class="markdownTableBodyNone">Provide asynchronous driver for MongoDB   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT} AND x86* AND NOT *BSD    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_POSTGRESQL   </td><td class="markdownTableBodyNone">Provide asynchronous driver for PostgreSQL   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_REDIS   </td><td class="markdownTableBodyNone">Provide asynchronous driver for Redis   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_CLICKHOUSE   </td><td class="markdownTableBodyNone">Provide asynchronous driver for ClickHouse   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT} AND x86*    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_GRPC   </td><td class="markdownTableBodyNone">Provide asynchronous driver for gRPC   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_KAFKA   </td><td class="markdownTableBodyNone">Provide asynchronous driver for Apache Kafka   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_RABBITMQ   </td><td class="markdownTableBodyNone">Provide asynchronous driver for RabbitMQ (AMQP 0-9-1)   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_MYSQL   </td><td class="markdownTableBodyNone">Provide asynchronous driver for MySQL/MariaDB   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_ROCKS   </td><td class="markdownTableBodyNone">Provide asynchronous driver for RocksDB   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_YDB   </td><td class="markdownTableBodyNone">Provide asynchronous driver for YDB   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT} AND C++ standard &gt;= 20    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_OTLP   </td><td class="markdownTableBodyNone">Provide Logger for OpenTelemetry protocol   </td><td class="markdownTableBodyNone">${USERVER_IS_THE_ROOT_PROJECT}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_UTEST   </td><td class="markdownTableBodyNone">Provide 'utest' and 'ubench' for unit testing and benchmarking coroutines   </td><td class="markdownTableBodyNone">${USERVER_FEATURE_CORE}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_CRYPTOPP_BLAKE2   </td><td class="markdownTableBodyNone">Provide wrappers for blake2 algorithms of crypto++   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_PATCH_LIBPQ   </td><td class="markdownTableBodyNone">Apply patches to the libpq (add portals support), requires libpq.a   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_CRYPTOPP_BASE64_URL   </td><td class="markdownTableBodyNone">Provide wrappers for Base64 URL decoding and encoding algorithms of crypto++   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_REDIS_HI_MALLOC   </td><td class="markdownTableBodyNone">Provide a <code>hi_malloc(unsigned long)</code> <a href="https://bugs.launchpad.net/ubuntu/+source/hiredis/+bug/1888025">issue</a> workaround   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_REDIS_TLS   </td><td class="markdownTableBodyNone">SSL/TLS support for Redis driver   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_STACKTRACE   </td><td class="markdownTableBodyNone">Allow capturing stacktraces using boost::stacktrace   </td><td class="markdownTableBodyNone">OFF if platform is not *BSD; ON otherwise    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_JEMALLOC   </td><td class="markdownTableBodyNone">Use jemalloc memory allocator   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_DWCAS   </td><td class="markdownTableBodyNone">Require double-width compare-and-swap   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_TESTSUITE   </td><td class="markdownTableBodyNone">Enable functional tests via testsuite   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_GRPC_CHANNELZ   </td><td class="markdownTableBodyNone">Enable Channelz for gRPC   </td><td class="markdownTableBodyNone">ON for "sufficiently new" gRPC versions    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_CHECK_PACKAGE_VERSIONS   </td><td class="markdownTableBodyNone">Check package versions   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_SANITIZE   </td><td class="markdownTableBodyNone">Build with sanitizers support, allows combination of values via 'val1 val2'   </td><td class="markdownTableBodyNone">''    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_SANITIZE_BLACKLIST   </td><td class="markdownTableBodyNone">Path to file that is passed to the -fsanitize-blacklist option   </td><td class="markdownTableBodyNone">''    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_USE_LD   </td><td class="markdownTableBodyNone">Linker to use, e.g. 'gold' or 'lld'   </td><td class="markdownTableBodyNone">''    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_LTO   </td><td class="markdownTableBodyNone">Use link time optimizations   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_LTO_CACHE   </td><td class="markdownTableBodyNone">Use LTO cache if present, disable for benchmarking build times   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_LTO_CACHE_DIR   </td><td class="markdownTableBodyNone">LTO cache directory   </td><td class="markdownTableBodyNone"><code>${CMAKE_CURRENT_BINARY_DIR}/.ltocache</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_LTO_CACHE_SIZE_MB   </td><td class="markdownTableBodyNone">LTO cache size limit in MB   </td><td class="markdownTableBodyNone">6000    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_USE_CCACHE   </td><td class="markdownTableBodyNone">Use ccache if present, disable for benchmarking build times   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_COMPILATION_TIME_TRACE   </td><td class="markdownTableBodyNone">Generate Clang compilation time trace   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_NO_WERROR   </td><td class="markdownTableBodyNone">Do not treat warnings as errors   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_PYTHON_PATH   </td><td class="markdownTableBodyNone">Path to the python3 binary for use in testsuite tests   </td><td class="markdownTableBodyNone">python3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_ERASE_LOG_WITH_LEVEL   </td><td class="markdownTableBodyNone">Logs of this and below levels are removed from binary. Possible values: trace, info, debug, warning, error   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_PIP_USE_SYSTEM_PACKAGES   </td><td class="markdownTableBodyNone">Use system python packages inside venv. Useful for Docker, CI and other controlled environments   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_PIP_OPTIONS   </td><td class="markdownTableBodyNone">Options for all pip calls. Useful for &lsquo;--no   </td><td class="markdownTableBodyNone">&rsquo;'    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGES   </td><td class="markdownTableBodyNone">Download missing third party packages and use the downloaded versions   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_BROTLI   </td><td class="markdownTableBodyNone">Download and setup Brotli if no Brotli of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CARES   </td><td class="markdownTableBodyNone">Download and setup c-ares if no c-ares of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CCTZ   </td><td class="markdownTableBodyNone">Download and setup cctz if no cctz of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CLICKHOUSECPP   </td><td class="markdownTableBodyNone">Download and setup clickhouse-cpp   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CRYPTOPP   </td><td class="markdownTableBodyNone">Download and setup CryptoPP if no CryptoPP of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CURL   </td><td class="markdownTableBodyNone">Download and setup libcurl if no libcurl of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_FMT   </td><td class="markdownTableBodyNone">Download and setup Fmt if no Fmt of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_GBENCH   </td><td class="markdownTableBodyNone">Download and setup gbench if no gbench of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_GRPC   </td><td class="markdownTableBodyNone">Download and setup gRPC if no gRPC of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_GTEST   </td><td class="markdownTableBodyNone">Download and setup gtest if no gtest of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_PROTOBUF   </td><td class="markdownTableBodyNone">Download and setup Protobuf if no Protobuf of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGE_GRPC}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_KAFKA   </td><td class="markdownTableBodyNone">Download and setup librdkafka if no librdkafka matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_YDBCPPSDK   </td><td class="markdownTableBodyNone">Download and setup ydb-cpp-sdk if no ydb-cpp-sdk of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FORCE_DOWNLOAD_PACKAGES   </td><td class="markdownTableBodyNone">Download all possible third-party packages even if there is an installed system package   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FORCE_DOWNLOAD_PROTOBUF   </td><td class="markdownTableBodyNone">Download Protobuf even if there is an installed system package   </td><td class="markdownTableBodyNone">${USERVER_FORCE_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FORCE_DOWNLOAD_GRPC   </td><td class="markdownTableBodyNone">Download gRPC even if there is an installed system package   </td><td class="markdownTableBodyNone">${USERVER_FORCE_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_INSTALL   </td><td class="markdownTableBodyNone">Build userver for further installation   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_IS_THE_ROOT_PROJECT   </td><td class="markdownTableBodyNone">Contributor mode: build userver tests, samples and helper tools   </td><td class="markdownTableBodyNone">auto-detects if userver is the top level project    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_GOOGLE_COMMON_PROTOS_TARGET   </td><td class="markdownTableBodyNone">Name of cmake target preparing google common proto library   </td><td class="markdownTableBodyNone">Builds userver-api-common-protos    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_GOOGLE_COMMON_PROTOS   </td><td class="markdownTableBodyNone">Path to the folder with google common proto files   </td><td class="markdownTableBodyNone">Downloads automatically    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_PG_SERVER_INCLUDE_DIR   </td><td class="markdownTableBodyNone">Path to the folder with <a class="el" href="#POSTGRES_LIBS">PostgreSQL server headers</a>, e.g. /usr/include/postgresql/15/server   </td><td class="markdownTableBodyNone">autodetected    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_PG_SERVER_LIBRARY_DIR   </td><td class="markdownTableBodyNone">Path to the folder with <a class="el" href="#POSTGRES_LIBS">PostgreSQL server libraries</a>, e.g. /usr/lib/postgresql/15/lib   </td><td class="markdownTableBodyNone">autodetected    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_PG_INCLUDE_DIR   </td><td class="markdownTableBodyNone">Path to the folder with <a class="el" href="#POSTGRES_LIBS">PostgreSQL libpq headers</a>, e.g. /usr/local/include   </td><td class="markdownTableBodyNone">autodetected    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_PG_LIBRARY_DIR   </td><td class="markdownTableBodyNone">Path to the folder with <a class="el" href="#POSTGRES_LIBS">PostgreSQL libpq libraries</a>, e.g. /usr/local/lib   </td><td class="markdownTableBodyNone">autodetected    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_MYSQL_ALLOW_BUGGY_LIBMARIADB   </td><td class="markdownTableBodyNone">Allows mysql driver to leak memory instead of aborting in some rare cases when linked against libmariadb3&lt;3.3.4   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DISABLE_PHDR_CACHE   </td><td class="markdownTableBodyNone">Disable caching of dl_phdr_info items, which interferes with dlopen   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DISABLE_RSEQ_ACCELERATION   </td><td class="markdownTableBodyNone">Disable rseq-based optimizations, which may not work depending on kernel/glibc/distro/etc version   </td><td class="markdownTableBodyNone">OFF for x86 Linux, ON otherwise    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_UBOOST_CORO   </td><td class="markdownTableBodyNone">Build with vendored version of Boost.context and Boost.coroutine2, is needed for sanitizers builds   </td><td class="markdownTableBodyNone">OFF for arm64 macOS, ON otherwise    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_GENERATE_PROTOS_AT_CONFIGURE   </td><td class="markdownTableBodyNone">Run protoc at CMake Configure time for better IDE integration   </td><td class="markdownTableBodyNone">OFF for downloaded Protobuf, ON otherwise   </td></tr>
</table>
<p>To explicitly specialize the compiler use the cmake options <code>CMAKE_C_COMPILER</code> and <code>CMAKE_CXX_COMPILER</code>. For example to use clang-12 compiler install it and add the following options to cmake: <code>-DCMAKE_CXX_COMPILER=clang++-12 -DCMAKE_C_COMPILER=clang-12</code></p>
<dl class="section warning"><dt>Warning</dt><dd>Using LTO can lead to <a href="https://github.com/userver-framework/userver/issues/242">some problems</a>. We don't recommend using <code>USERVER_LTO</code>.</dd></dl>
<p><a class="anchor" id="userver_libraries"></a></p>
<h1><a class="anchor" id="autotoc_md599"></a>
The list of userver libraries</h1>
<p>userver is split into multiple CMake libraries.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">CMake target   </th><th class="markdownTableHeadNone">CMake option to enable building the library   </th><th class="markdownTableHeadNone">Component for install   </th><th class="markdownTableHeadNone">Main documentation page    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>userver::universal</code>   </td><td class="markdownTableBodyNone">Always on   </td><td class="markdownTableBodyNone"><code>universal</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../de/d6a/md_en_2index.html">The C++ Asynchronous Framework</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>userver::universal-utest</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_UTEST</code> (<code>ON</code> by default)   </td><td class="markdownTableBodyNone"><code>universal</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../d4/d70/md_en_2userver_2testing.html">Unit Tests and Benchmarks</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>userver::core</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_CORE</code> (<code>ON</code> by default)   </td><td class="markdownTableBodyNone"><code>core</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../de/d6a/md_en_2index.html">The C++ Asynchronous Framework</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>userver::utest</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_CORE</code> + <code>USERVER_FEATURE_UTEST</code>   </td><td class="markdownTableBodyNone"><code>core</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../d4/d70/md_en_2userver_2testing.html">Unit Tests and Benchmarks</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>userver::ubench</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_CORE</code> + <code>USERVER_FEATURE_UTEST</code>   </td><td class="markdownTableBodyNone"><code>core</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../d4/d70/md_en_2userver_2testing.html">Unit Tests and Benchmarks</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>userver::grpc</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_GRPC</code>   </td><td class="markdownTableBodyNone"><code>grpc</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../d1/d06/md_en_2userver_2grpc.html">gRPC</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>userver::grpc-utest</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_GRPC</code> + <code>USERVER_FEATURE_UTEST</code>   </td><td class="markdownTableBodyNone"><code>grpc</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../d1/d06/md_en_2userver_2grpc.html">gRPC</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>userver::mongo</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_MONGODB</code>   </td><td class="markdownTableBodyNone"><code>mongo</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../d7/d65/md_en_2userver_2mongodb.html">MongoDB</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>userver::postgresql</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_POSTGRESQL</code>   </td><td class="markdownTableBodyNone"><code>postgresql</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../de/de0/pg_driver.html">uPg Driver</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>userver::redis</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_REDIS</code>   </td><td class="markdownTableBodyNone"><code>redis</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../dd/dde/md_en_2userver_2redis.html">Redis</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>userver::clickhouse</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_CLICKHOUSE</code>   </td><td class="markdownTableBodyNone"><code>clickhouse</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../dd/ddb/clickhouse_driver.html">ClickHouse Driver</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>userver::kafka</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_KAFKA</code>   </td><td class="markdownTableBodyNone"><code>kafka</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../d0/db8/md_en_2userver_2kafka.html">Apache Kafka</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>userver::kafka-utest</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_KAFKA</code> + <code>USERVER_FEATURE_UTEST</code>   </td><td class="markdownTableBodyNone"><code>kafka</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../d0/db8/md_en_2userver_2kafka.html">Apache Kafka</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>userver::rabbitmq</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_RABBITMQ</code>   </td><td class="markdownTableBodyNone"><code>rabbitmq</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../dd/de2/rabbitmq_driver.html">RabbitMQ (AMQP 0-9-1)</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>userver::mysql</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_MYSQL</code>   </td><td class="markdownTableBodyNone"><code>mysql</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../d2/d5f/md_en_2userver_2mysql_2mysql__driver.html">MySQL Driver</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>userver::rocks</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_ROCKS</code>   </td><td class="markdownTableBodyNone"><code>rocks</code>   </td><td class="markdownTableBodyNone">TODO    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>userver::ydb</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_YDB</code>   </td><td class="markdownTableBodyNone"><code>ydb</code>   </td><td class="markdownTableBodyNone">TODO    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>userver::otlp</code>   </td><td class="markdownTableBodyNone"><code>USERVER_FEATURE_OTLP</code>   </td><td class="markdownTableBodyNone"><code>otlp</code>   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/d0c/md_en_2userver_2logging.html#opentelemetry">OpenTelemetry Protocol</a>   </td></tr>
</table>
<p>Make sure to:</p>
<ol type="1">
<li>Enable the CMake options to build the libraries you need</li>
<li>Link against the libraries</li>
</ol>
<p>The details vary depending on the method of building userver:</p>
<ul>
<li><code>add_subsirectory(userver)</code> as used in <a class="el" href="#service_templates">service templates</a></li>
<li><a class="el" href="#userver_cpm">CPM</a></li>
<li><a class="el" href="../../da/de1/md_en_2userver_2tutorial_2build__userver.html#userver_conan">Conan</a></li>
<li><a class="el" href="#userver_install">userver install</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md600"></a>
Downloading packages using CPM</h1>
<p>userver uses <a href="https://github.com/cpm-cmake/CPM.cmake">CPM</a> for downloading missing packages.</p>
<p>By default, we first try to find the corresponding system package. With <code>USERVER_FORCE_DOWNLOAD_PACKAGES=ON</code>, no such attempt is made, and we skip straight to <code>CPMAddPackage</code>. This can be useful to guarantee that the build uses the latest (known to userver) versions of third-party packages.</p>
<p>You can control the usage of CPM with <code>USERVER_DOWNLOAD_*</code> options. For example, <code>USERVER_DOWNLOAD_PACKAGES=OFF</code> is useful for CI and other controlled environments to make sure that no download attempts are made, which ensures repeatability and the best CI build speed.</p>
<p>For details on the download options, refer to <a href="https://github.com/cpm-cmake/CPM.cmake">CPM</a> documentation. Some advice:</p>
<ul>
<li><code>CPM_SOURCE_CACHE</code> helps to avoid re-downloads with multiple userver build modes or multiple CPM-using projects;</li>
<li><code>CPM_USE_NAMED_CACHE_DIRECTORIES</code> (which userver enables by default) avoids junk library names shown in IDEs.</li>
</ul>
<p><a class="anchor" id="userver_cpm"></a></p>
<h2><a class="anchor" id="autotoc_md601"></a>
Downloading userver using CPM</h2>
<p>userver itself can be downloaded and built using CPM.</p>
<div class="fragment"><div class="line">CPMAddPackage(</div>
<div class="line">    NAME userver</div>
<div class="line">    VERSION (userver release version or git commit hash)</div>
<div class="line">    GIT_TAG (userver release version or git commit hash)</div>
<div class="line">    GITHUB_REPOSITORY userver-framework/userver</div>
<div class="line">    OPTIONS</div>
<div class="line">    &quot;USERVER_FEATURE_GRPC ON&quot;</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">target_link_libraries(${PROJECT_NAME} userver::grpc)</div>
</div><!-- fragment --><p>Make sure to enable the CMake options to build userver libraries you need, then link to those libraries.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#userver_libraries">userver_libraries</a></dd></dl>
<p><a class="anchor" id="service_templates"></a></p>
<h1><a class="anchor" id="autotoc_md602"></a>
Build dependencies and instructions for userver based services</h1>
<p>There are prepared and ready to use service templates at the github:</p>
<ul>
<li><a href="https://github.com/userver-framework/service_template">https://github.com/userver-framework/service_template</a></li>
<li><a href="https://github.com/userver-framework/pg_service_template">https://github.com/userver-framework/pg_service_template</a></li>
<li><a href="https://github.com/userver-framework/pg_grpc_service_template">https://github.com/userver-framework/pg_grpc_service_template</a></li>
</ul>
<p>Just use the template to make your own service:</p>
<ol type="1">
<li>Press the green "Use this template" button at the top of the github template page</li>
<li>Clone the service <code>git clone your-service-repo &amp;&amp; cd your-service-repo</code></li>
<li>Give a proper name to your service and replace all the occurrences of "*service_template" string with that name.</li>
<li>Feel free to tweak, adjust or fully rewrite the source code of your service.</li>
</ol>
<p>For local development of your service either</p>
<ul>
<li>use the docker build and tests run via <code>make docker-test</code>;</li>
<li>or install the build dependencies on your local system and adjust the <code>Makefile.local</code> file to provide <b>platform-specific</b> <b>CMake</b> options to the template:</li>
</ul>
<p>The service templates allow to kickstart the development of your production-ready service, but there can't be a repo for each and every combination of userver libraries. To use additional userver libraries, e.g. <code>userver::grpc</code>, add to the root <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">set(USERVER_FEATURE_GRPC ON CACHE BOOL &quot;&quot; FORCE)</div>
<div class="line"># ...</div>
<div class="line">add_subdirectory(third_party/userver)</div>
<div class="line"># ...</div>
<div class="line">target_link_libraries(${PROJECT_NAME} userver::grpc)</div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="#userver_libraries">userver_libraries</a></dd></dl>
<p>See <a class="el" href="../../de/d6a/md_en_2index.html#tutorial_services">tutorial_services</a> for minimal usage examples of various userver libraries.</p>
<p><a class="anchor" id="ubuntu_24_04"></a></p>
<h2><a class="anchor" id="autotoc_md603"></a>
Ubuntu 24.04 (Noble Numbat)</h2>
<p><b>Dependencies:</b> <a class="el" href="../../d5/d6a/md_en_2deps_2ubuntu-24_804.html">third_party/userver/scripts/docs/en/deps/ubuntu-24.04.md</a></p>
<p>Dependencies could be installed via: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install --allow-downgrades -y $(cat third_party/userver/scripts/docs/en/deps/ubuntu-24.04.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><p><a class="anchor" id="ubuntu_22_04"></a></p>
<h2><a class="anchor" id="autotoc_md604"></a>
Ubuntu 22.04 (Jammy Jellyfish)</h2>
<p><b>Dependencies:</b> <a class="el" href="../../de/d9c/md_en_2deps_2ubuntu-22_804.html">third_party/userver/scripts/docs/en/deps/ubuntu-22.04.md</a></p>
<p>Dependencies could be installed via: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install --allow-downgrades -y $(cat third_party/userver/scripts/docs/en/deps/ubuntu-22.04.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md605"></a>
Docker with Ubuntu 22.04</h2>
<p>The Docker image <code>ghcr.io/userver-framework/ubuntu-22.04-userver-pg:latest</code> provides a container with all the build dependencies, PostgreSQL and userver preinstalled and with a proper setup of PPAs with databases, compilers, tools.</p>
<p>To run it just use a command like </p><div class="fragment"><div class="line">docker run --rm -it --network ip6net --entrypoint bash ghcr.io/userver-framework/ubuntu-22.04-userver-pg:latest</div>
</div><!-- fragment --><p>The Docker image <code>ghcr.io/userver-framework/ubuntu-22.04-userver:latest</code> provides a container with all the build dependencies and userver preinstalled and with a proper setup of PPAs with databases, compilers, tools.</p>
<p>To run it just use a command like </p><div class="fragment"><div class="line">docker run --rm -it --network ip6net --entrypoint bash ghcr.io/userver-framework/ubuntu-22.04-userver:latest</div>
</div><!-- fragment --><p>The Docker image <code>ghcr.io/userver-framework/ubuntu-22.04-userver-base:latest</code> provides a container with all the build dependencies preinstalled and with a proper setup of PPAs with databases, compilers and tools.</p>
<p>To run it just use a command like </p><div class="fragment"><div class="line">docker run --rm -it --network ip6net --entrypoint bash ghcr.io/userver-framework/ubuntu-22.04-userver-base:latest</div>
</div><!-- fragment --><p>After that, install the databases and compiler you are planning to use via <code>apt install</code> and start developing.</p>
<dl class="section note"><dt>Note</dt><dd>The above image is build from <code>scripts/docker/ubuntu-22.04-pg.dockerfile</code>, <code>scripts/docker/ubuntu-22.04.dockerfile</code> and <code>scripts/docker/base-ubuntu-22.04.dockerfile</code> respectively. See <code>scripts/docker/</code> directory and <a class="el" href="../../d7/df3/md__2data_2code_2userver_2scripts_2docker_2Readme.html">Building Docker container for userver</a> for more inspiration on building your own custom docker containers.</dd></dl>
<h2><a class="anchor" id="autotoc_md606"></a>
Yandex Cloud with Ubuntu 22.04</h2>
<p>The userver framework is <a href="https://yandex.cloud/en/marketplace/products/yc/userver">available at Yandex Cloud Marketplace</a>.</p>
<p>To create a VM with preinstalled userver just click the "Create VM" button and pay for the Cloud hardware usage.</p>
<p>After that the VM is ready to use. SSH to it and use <code>find_package(userver REQUIRED)</code> in the <code>CMakeLists.txt</code> to use the preinstalled userver framework.</p>
<p>If there a need to update the userver in the VM do the following: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt remove libuserver-*</div>
<div class="line"> </div>
<div class="line">cd /app/userver</div>
<div class="line">sudo git checkout develop</div>
<div class="line">sudo git pull</div>
<div class="line">sudo ./scripts/build_and_install_all.sh</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md607"></a>
Ubuntu 21.10 (Impish Indri)</h2>
<p><b>Dependencies:</b> <a class="el" href="../../d1/dc1/md_en_2deps_2ubuntu-21_810.html">third_party/userver/scripts/docs/en/deps/ubuntu-21.10.md</a></p>
<p>Dependencies could be installed via: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install --allow-downgrades -y $(cat third_party/userver/scripts/docs/en/deps/ubuntu-21.10.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md608"></a>
Ubuntu 20.04 (Focal Fossa)</h2>
<p><b>Dependencies:</b> <a class="el" href="../../d9/d65/md_en_2deps_2ubuntu-20_804.html">third_party/userver/scripts/docs/en/deps/ubuntu-20.04.md</a></p>
<p>Dependencies could be installed via: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install --allow-downgrades -y $(cat third_party/userver/scripts/docs/en/deps/ubuntu-20.04.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><p><b>Recommended</b> <b>Makefile.local:</b> </p><div class="fragment"><div class="line">CMAKE_COMMON_FLAGS += \</div>
<div class="line">    -DUSERVER_FEATURE_CRYPTOPP_BLAKE2=0 \</div>
<div class="line">    -DUSERVER_FEATURE_REDIS_HI_MALLOC=1</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md609"></a>
Ubuntu 18.04 (Bionic Beaver)</h2>
<p><b>Dependencies:</b> <a class="el" href="../../d7/d6f/md_en_2deps_2ubuntu-18_804.html">third_party/userver/scripts/docs/en/deps/ubuntu-18.04.md</a></p>
<p>Dependencies could be installed via: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install --allow-downgrades -y $(cat third_party/userver/scripts/docs/en/deps/ubuntu-18.04.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><p><b>Recommended</b> <b>Makefile.local:</b> </p><div class="fragment"><div class="line">CMAKE_COMMON_FLAGS += \</div>
<div class="line">    -DCMAKE_CXX_COMPILER=g++-8 \</div>
<div class="line">    -DCMAKE_C_COMPILER=gcc-8 \</div>
<div class="line">    -DUSERVER_FEATURE_CRYPTOPP_BLAKE2=0 \</div>
<div class="line">    -DUSERVER_FEATURE_CRYPTOPP_BASE64_URL=0 \</div>
<div class="line">    -DUSERVER_USE_LD=gold</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md610"></a>
Debian 11</h2>
<p><b>Dependencies:</b> <a class="el" href="../../da/d91/md_en_2deps_2debian-11.html">third_party/userver/scripts/docs/en/deps/debian-11.md</a></p>
<h2><a class="anchor" id="autotoc_md611"></a>
Debian 11 32-bit</h2>
<p><b>Dependencies:</b> <a class="el" href="../../da/d91/md_en_2deps_2debian-11.html">third_party/userver/scripts/docs/en/deps/debian-11.md</a> (same as above)</p>
<p><b>Recommended</b> <b>Makefile.local:</b> </p><div class="fragment"><div class="line">CMAKE_COMMON_FLAGS += \</div>
<div class="line">    -DCMAKE_C_FLAGS=&#39;-D_FILE_OFFSET_BITS=64&#39; \</div>
<div class="line">    -DCMAKE_CXX_FLAGS=&#39;-D_FILE_OFFSET_BITS=64&#39;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md612"></a>
Fedora 35</h2>
<p><b>Dependencies:</b> <a class="el" href="../../df/d3a/md_en_2deps_2fedora-36.html">third_party/userver/scripts/docs/en/deps/fedora-35.md</a></p>
<p>Fedora dependencies could be installed via: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo dnf install -y $(cat third_party/userver/scripts/docs/en/deps/fedora-35.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><p><b>Recommended</b> <b>Makefile.local:</b> </p><div class="fragment"><div class="line">CMAKE_COMMON_FLAGS += \</div>
<div class="line">    -DUSERVER_FEATURE_STACKTRACE=0 \</div>
<div class="line">    -DUSERVER_FEATURE_PATCH_LIBPQ=0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md613"></a>
Fedora 36</h2>
<p><b>Dependencies:</b> <a class="el" href="../../df/d3a/md_en_2deps_2fedora-36.html">third_party/userver/scripts/docs/en/deps/fedora-36.md</a></p>
<p>Fedora dependencies could be installed via: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo dnf install -y $(cat third_party/userver/scripts/docs/en/deps/fedora-36.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><p><b>Recommended</b> <b>Makefile.local:</b> </p><div class="fragment"><div class="line">CMAKE_COMMON_FLAGS += \</div>
<div class="line">    -DUSERVER_FEATURE_STACKTRACE=0 \</div>
<div class="line">    -DUSERVER_FEATURE_PATCH_LIBPQ=0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md614"></a>
Gentoo</h2>
<p><b>Dependencies:</b> <a class="el" href="../../d0/d28/md_en_2deps_2gentoo.html">third_party/userver/scripts/docs/en/deps/gentoo.md</a></p>
<p>Dependencies could be installed via: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo emerge --ask --update --oneshot $(cat scripts/docs/en/deps/gentoo.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><p><b>Recommended</b> <b>Makefile.local:</b> </p><div class="fragment"><div class="line">CMAKE_COMMON_FLAGS += \</div>
<div class="line">    -DUSERVER_CHECK_PACKAGE_VERSIONS=0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md615"></a>
Arch, Manjaro</h2>
<p><b>Dependencies:</b> <a class="el" href="../../d1/d94/md_en_2deps_2arch.html">third_party/userver/scripts/docs/en/deps/arch.md</a></p>
<p>Using an AUR helper (pikaur in this example) the dependencies could be installed as: </p><div class="fragment"><div class="line">bash</div>
<div class="line">pikaur -S $(cat third_party/userver/scripts/docs/en/deps/arch.md | sed &#39;s/^makepkg|//g&#39; | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><p>Without AUR: </p><div class="fragment"><div class="line">bash</div>
<div class="line">sudo pacman -S $(cat third_party/userver/scripts/docs/en/deps/arch.md | grep -v -- &#39;makepkg|&#39; | tr &#39;\n&#39; &#39; &#39;)</div>
<div class="line">cat third_party/userver/scripts/docs/en/deps/arch.md | grep -oP &#39;^makepkg\|\K.*&#39; | while read ;\</div>
<div class="line">  do \</div>
<div class="line">    DIR=$(mktemp -d) ;\</div>
<div class="line">    git clone https://aur.archlinux.org/$REPLY.git $DIR ;\</div>
<div class="line">    pushd $DIR ;\</div>
<div class="line">    yes|makepkg -si ;\</div>
<div class="line">    popd ;\</div>
<div class="line">    rm -rf $DIR ;\</div>
<div class="line">  done</div>
</div><!-- fragment --><p><b>Recommended</b> <b>Makefile.local:</b> </p><div class="fragment"><div class="line">CMAKE_COMMON_FLAGS += \</div>
<div class="line">    -DUSERVER_FEATURE_PATCH_LIBPQ=0</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md616"></a>
MacOS</h2>
<p><b>Dependencies:</b> <a class="el" href="../../dc/d3b/md_en_2deps_2macos.html">third_party/userver/scripts/docs/en/deps/macos.md</a>. At least MacOS 10.15 required with <a href="https://apps.apple.com/us/app/xcode/id497799835">Xcode</a> and <a href="https://brew.sh/">Homebrew</a>.</p>
<p>Dependencies could be installed via: </p><div class="fragment"><div class="line">brew install $(cat third_party/userver/scripts/docs/en/deps/macos.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --><p><b>Recommended</b> <b>Makefile.local:</b> </p><div class="fragment"><div class="line">CMAKE_COMMON_FLAGS += \</div>
<div class="line">    -DUSERVER_CHECK_PACKAGE_VERSIONS=0 \</div>
<div class="line">    -DUSERVER_FEATURE_REDIS_HI_MALLOC=1 \</div>
<div class="line">    -DUSERVER_FEATURE_CRYPTOPP_BLAKE2=0</div>
</div><!-- fragment --><p>After that the <code>make test</code> would build and run the service tests.</p>
<dl class="section warning"><dt>Warning</dt><dd>MacOS is recommended only for development as it may have performance issues in some cases.</dd></dl>
<h2><a class="anchor" id="autotoc_md617"></a>
Other POSIX based platforms</h2>
<p> <b>userver</b> works well on modern POSIX platforms. Follow the cmake hints for the installation of required packets and experiment with the CMake options.</p>
<p>Feel free to provide a PR with instructions for your favorite platform at <a href="https://github.com/userver-framework/userver">https://github.com/userver-framework/userver</a>.</p>
<p>If there's a strong need to build <b>only</b> the userver and run its tests, then see <a class="el" href="../../da/de1/md_en_2userver_2tutorial_2build__userver.html">Build instructions for userver</a></p>
<p><a class="anchor" id="userver_install"></a></p>
<h1><a class="anchor" id="autotoc_md618"></a>
Install</h1>
<p>You can install userver globally and then use it from anywhere with <code>find_package</code>. Make sure to use the same build mode as for your service, otherwise subtle linkage issues will arise.</p>
<h2><a class="anchor" id="autotoc_md619"></a>
Install with cmake &ndash;install</h2>
<p>To install userver build it with <code>USERVER_INSTALL=ON</code> flags in <code>Debug</code> and <code>Release</code> modes: </p><div class="fragment"><div class="line">cmake -S./ -B./build_debug \</div>
<div class="line">    -DCMAKE_BUILD_TYPE=Debug \</div>
<div class="line">    -DUSERVER_INSTALL=ON \</div>
<div class="line">    -DUSERVER_SANITIZE=&quot;ub addr&quot; \</div>
<div class="line">    -GNinja</div>
<div class="line">cmake -S./ -B./build_release \</div>
<div class="line">    -DCMAKE_BUILD_TYPE=Release \</div>
<div class="line">    -DUSERVER_INSTALL=ON \</div>
<div class="line">    -GNinja</div>
<div class="line">cmake --build build_debug/</div>
<div class="line">cmake --build build_release/</div>
<div class="line">cmake --install build_debug/</div>
<div class="line">cmake --install build_release/</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md620"></a>
Build and install Debian package</h2>
<p>To build <code>libuserver-all-dev.deb</code> package run the following shell command:</p>
<div class="fragment"><div class="line">docker run --rm -it --network ip6net -v $(pwd):/home/user -w /home/user/userver \</div>
<div class="line">   --entrypoint bash ghcr.io/userver-framework/ubuntu-22.04-userver-base:latest ./scripts/docker/run_as_user.sh \</div>
<div class="line">   ./scripts/build_and_install_all.sh</div>
</div><!-- fragment --><p>And install the package with the following:</p>
<div class="fragment"><div class="line">sudo dpkg -i ./libuserver-all-dev*.deb</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md621"></a>
Use userver in your projects</h2>
<p>Next, write </p><div class="fragment"><div class="line">find_package(userver REQUIRED COMPONENTS core postgresql grpc redis clickhouse mysql rabbitmq mongo)</div>
</div><!-- fragment --><p> in your <code>CMakeLists.txt</code>. Choose only the necessary components. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="#userver_libraries">userver_libraries</a></dd></dl>
<p>Finally, link your source with userver component.</p>
<p>For instance: </p><div class="fragment"><div class="line">target_link_libraries(${PROJECT_NAME}_objs PUBLIC userver::postgresql)</div>
</div><!-- fragment --><p>Done! You can use installed userver.</p>
<h2><a class="anchor" id="autotoc_md622"></a>
Additional information:</h2>
<p>Link <code>mariadbclient</code> additionally for mysql component:</p>
<div class="fragment"><div class="line">target_link_libraries(${PROJECT_NAME}-mysql_objs PUBLIC userver::mysql mariadbclient)</div>
</div><!-- fragment --><p><a class="anchor" id="POSTGRES_LIBS"></a></p>
<h1><a class="anchor" id="autotoc_md623"></a>
PostgreSQL versions</h1>
<p>If CMake option <code>USERVER_FEATURE_PATCH_LIBPQ</code> is on, then the same developer version of libpq, libpgport and libpgcommon libraries should be available on the system. If there are multiple versions of those libraries use USERVER_PG_* CMake options to aid the build system in finding the right version.</p>
<p>You could also install any version of the above libraries by explicitly pinning the version. For example in Debian/Ubuntu pinning to version 14 could be done via the following commands: </p><div class="fragment"><div class="line">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7FCC7D46ACCC4CF8</div>
<div class="line">echo &quot;deb https://apt-archive.postgresql.org/pub/repos/apt jammy-pgdg-archive main&quot; | sudo tee /etc/apt/sources.list.d/pgdg.list</div>
<div class="line">sudo apt update</div>
<div class="line"> </div>
<div class="line">sudo mkdir -p /etc/apt/preferences.d</div>
<div class="line"> </div>
<div class="line">printf &quot;Package: postgresql-14\nPin: version 14.5*\nPin-Priority: 1001\n&quot; | sudo tee -a /etc/apt/preferences.d/postgresql-14</div>
<div class="line">printf &quot;Package: postgresql-client-14\nPin: version 14.5*\nPin-Priority: 1001\n&quot; | sudo tee -a /etc/apt/preferences.d/postgresql-client-14</div>
<div class="line">sudo apt install --allow-downgrades -y postgresql-14 postgresql-client-14</div>
<div class="line"> </div>
<div class="line">printf &quot;Package: libpq5\nPin: version 14.5*\nPin-Priority: 1001\n&quot; | sudo tee -a /etc/apt/preferences.d/libpq5</div>
<div class="line">printf &quot;Package: libpq-dev\nPin: version 14.5*\nPin-Priority: 1001\n&quot;| sudo tee -a /etc/apt/preferences.d/libpq-dev</div>
<div class="line">sudo apt install --allow-downgrades -y libpq5 libpq-dev</div>
</div><!-- fragment --><hr  />
<p> <div class="bottom-nav">   <a class="el" href="../../d0/dd5/md_en_2userver_2supported__platforms.html">Supported Platforms</a> | <a class="el" href="../../d2/d58/md_en_2userver_2deploy__env.html">Deploy Environment Specific Configurations</a>   </div>  </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Oct 21 2024 13:56:00 for userver by
    <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.10.0</li>
  </ul>
</div>
<script type="text/javascript" src="../../codeHighlight.js"></script>
<script type="text/javascript" src="../../telegramLanguage.js"></script>
<script type="text/javascript" src="../../styledBtn.js"></script>
<script type="text/javascript" src="../../search.js"></script>
<script type="text/javascript" src="../../header.js"></script>
<script type="text/javascript" src="../../searchHighlight.js"></script>
<script>
  const addLinks = () =>  {
      const links = document.createElement('div')
      links.id = 'links';
      links.innerHTML = `
          <a href="https://github.com/userver-framework/" id='github_header' rel="noopener" target="_blank" class="titlelink">
              <img src="../../github_logo.svg" alt="Github" class="gh-logo"/>
          </a>
          <a href="https://t.me/userver_en" rel="noopener" id='telegram_channel' target="_blank" class="titlelink generic_tg_link">
              <img src="../../telegram_logo.svg" alt="Telegram"/>
          </a>
      `
      document.getElementById('main-navbar').appendChild(links);
  }
  $(function() {
    $(document).ready(function() {
      setTimeout(() => {
      init_all_results_button();
      init_search_hotkey();
      init_header();
      addLinks();
      changeTelegramChannelLanguageForRussianSpeakingUser();
      document.getElementById("side-nav").style.display = "none";
      const isLanding = document.getElementById('landing_logo_id') !== null;
      if (isLanding) return;
      highlight_code();
      styleNavButtons();
    }, 0);
    });
  });
</script>
<script type="module" src="../../toc.js"></script>
</body>
</html>
