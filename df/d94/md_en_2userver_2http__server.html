<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <!-- Yandex.Metrika counter -->
      <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(94541714, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
      </script>
      <noscript><div><img src="https://mc.yandex.ru/watch/94541714" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
      <!-- /Yandex.Metrika counter -->
      <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=9"/>
      <meta name="generator" content="Doxygen 1.10.0"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:image" content="../../logo_in_circle.png"/>
      <meta property="og:image:alt" content="userver logo"/>
      <link rel="icon" href="../../favicon.svg">
      <title>userver: HTTP, HTTPS, WebSocket</title>
      <!-- Roboto fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <!-- Roboto fonts -->
      <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="../../jquery.js"></script>
      <!-- Highlight.js -->
      <link rel="stylesheet" href="../../highlightjs.css">
      <script src="../../highlight.min.js"></script>
      <!-- Highlight.js -->
      <!-- Roboto fonts -->
      <script type="text/javascript" src="../../dynsections.js"></script>
      <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
      <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
      <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
      <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
      <link rel="stylesheet" href="../../customdoxygen.css">
      <!-- Doxygen Awesome -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
      <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
        DoxygenAwesomeParagraphLink.init()
        DoxygenAwesomeInteractiveToc.topOffset = 180;
      </script>
      <!-- Doxygen Awesome -->
    </head>
    <body>
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0" style="width: 100%;">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
                <td id="projectalign">
                  <div id="projectname">
                    <a class="titlelink" href="../../index.html">userver
                    </a>
                  </div>
                  <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework</a></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('df/d94/md_en_2userver_2http__server.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">HTTP, HTTPS, WebSocket</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md319"></a> <b>Quality:</b></p><ul>
<li>HTTP 1.x - <a class="el" href="../../db/d57/md_en_2userver_2development_2stability.html#QUALITY_TIERS">Platinum Tier</a>.</li>
<li>HTTPS 1.x - <a class="el" href="../../db/d57/md_en_2userver_2development_2stability.html#QUALITY_TIERS">Golden Tier</a>.</li>
<li>WebSocket - <a class="el" href="../../db/d57/md_en_2userver_2development_2stability.html#QUALITY_TIERS">Golden Tier</a>.</li>
<li>HTTP 2.0 - <a class="el" href="../../db/d57/md_en_2userver_2development_2stability.html#QUALITY_TIERS">Silver Tier</a>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md320"></a>
Introduction</h1>
<p>üêô <b>userver</b> implements HTTP/HTTPS 1.1, HTTP 2.0 and WebSocket server in <code>userver-core</code> library using <a class="el" href="../../d0/d0b/classcomponents_1_1Server.html">components::Server</a> component.</p>
<h1><a class="anchor" id="autotoc_md321"></a>
Capabilities</h1>
<ul>
<li>HTTP 1.1/1.0 support;</li>
<li>HTTPS;</li>
<li><a class="el" href="../../d7/d9e/md_en_2userver_2tutorial_2websocket__service.html">WebSocket</a>;</li>
<li>Body decompression with "Content-Encoding: gzip";</li>
<li>HTTP pipelining;</li>
<li>Custom authorization <a class="el" href="../../da/d24/md_en_2userver_2tutorial_2auth__postgres.html">Custom Authorization/Authentication via PostgreSQL</a> ;</li>
<li>Rate limiting via Congestion control and indiviadual handlers configuration;</li>
<li>Requests-in-flight limiting;</li>
<li>Requests-in-flight inspection via <a class="el" href="../../d8/d67/classserver_1_1handlers_1_1InspectRequests.html" title="Handler that returns information about all in-flight requests.">server::handlers::InspectRequests</a> ;</li>
<li>Body size / headers count / URL length / etc. limits;</li>
<li>Streaming;</li>
<li><a class="el" href="../../df/d0f/md_en_2userver_2tutorial_2multipart__service.html">File uploads and multipart/form-data</a></li>
<li><a class="el" href="../../d6/d64/md_en_2userver_2deadline__propagation.html">Deadline propagation</a> .</li>
<li><a class="el" href="../../d6/dcc/md_en_2userver_2http__server__middlewares.html">Middlewares</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md322"></a>
Streaming API</h1>
<p>Interactive clients (e.g. web browser) might want to get at least first bytes of the HTTP response if the whole HTTP response is generated slowly. In this case the HTTP handler might want to use Streaming API and return HTTP response body as a byte stream rather than as a single-part blob.</p>
<p>To enable Streaming API in your handler:</p>
<p>1) define HandleStreamRequest() method: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;userver/server/http/http_response_body_stream_fwd.hpp&gt;</span></div>
<div class="line">...</div>
<div class="line">  <span class="keywordtype">void</span> HandleStreamRequest(<span class="keyword">const</span> <a class="code hl_class" href="../../d3/d44/classserver_1_1http_1_1HttpRequest.html" title="HTTP Request data.">server::http::HttpRequest</a>&amp;,</div>
<div class="line">                           <a class="code hl_class" href="../../de/df6/classserver_1_1request_1_1RequestContext.html" title="Stores request-specific data during request processing.">server::request::RequestContext</a>&amp;,</div>
<div class="line">                           <a class="code hl_class" href="../../dd/d63/classserver_1_1http_1_1ResponseBodyStream.html">server::http::ResponseBodyStream</a>&amp;) <span class="keyword">const override</span>;</div>
</div><!-- fragment --><p>2) Enable Streaming API in static config: </p><div class="fragment"><div class="line">components_manager:</div>
<div class="line">    components:</div>
<div class="line">        handler-stream-api:</div>
<div class="line">            response-body-stream: true</div>
</div><!-- fragment --><p>3) Set dynamic config <a class="el" href="../../de/d10/md_en_2schemas_2dynamic__configs.html#USERVER_HANDLER_STREAM_API_ENABLED">USERVER_HANDLER_STREAM_API_ENABLED</a>.</p>
<p>4) Write your handler code:</p>
<div class="fragment"><div class="line">    <span class="keywordtype">void</span> HandleStreamRequest(</div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_class" href="../../d3/d44/classserver_1_1http_1_1HttpRequest.html" title="HTTP Request data.">server::http::HttpRequest</a>&amp; request,</div>
<div class="line">        <a class="code hl_class" href="../../de/df6/classserver_1_1request_1_1RequestContext.html" title="Stores request-specific data during request processing.">server::request::RequestContext</a>&amp;,</div>
<div class="line">        <a class="code hl_class" href="../../dd/d63/classserver_1_1http_1_1ResponseBodyStream.html">server::http::ResponseBodyStream</a>&amp; response_body_stream</div>
<div class="line">    )<span class="keyword"> const override </span>{</div>
<div class="line">        <a class="code hl_class" href="../../dc/d2f/classhttp_1_1headers_1_1HeaderMap.html" title="Container that maps case-insensitive header name into header value.">::clients::http::Headers</a> headers;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; header_name : request.GetHeaderNames()) {</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; header_value = request.<a class="code hl_function" href="../../d3/d44/classserver_1_1http_1_1HttpRequest.html#a1d035d2f00417e03b85dc75c3453f322">GetHeader</a>(header_name);</div>
<div class="line">            headers[header_name] = header_value;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; port = request.<a class="code hl_function" href="../../d3/d44/classserver_1_1http_1_1HttpRequest.html#aea82de2fbb3e8ed97ba400b38cc706bb">GetArg</a>(<span class="stringliteral">&quot;port&quot;</span>);</div>
<div class="line">        <span class="keyword">auto</span> url = fmt::format(<span class="stringliteral">&quot;http://localhost:{}/test&quot;</span>, port);</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; timeout_string = request.<a class="code hl_function" href="../../d3/d44/classserver_1_1http_1_1HttpRequest.html#aea82de2fbb3e8ed97ba400b38cc706bb">GetArg</a>(<span class="stringliteral">&quot;timeout&quot;</span>);</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> timeout = timeout_string.empty() ? kDefaultTimeout : std::chrono::seconds{std::stoi(timeout_string)};</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> retries = 1;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> external_request =</div>
<div class="line">            http_client_.CreateRequest().get(url).headers(std::move(headers)).timeout(timeout).retry(retries);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> queue = <a class="code hl_function" href="../../d8/d97/classconcurrent_1_1GenericQueue.html#acf65f4cc5fc01927a8f5803cd0d54456" title="Create a new queue.">concurrent::StringStreamQueue::Create</a>();</div>
<div class="line">        <span class="keyword">auto</span> client_response = external_request.async_perform_stream_body(std::move(queue));</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="../../d9/d1d/testpoint_8hpp.html#a8a6d27a839e4327f705ac8d965e4b6e8" title="Send testpoint notification. Works only if testpoint support is enabled (e.g. in components::TestsCon...">TESTPOINT</a>(<span class="stringliteral">&quot;stream_after_start&quot;</span>, {});</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; header_item : client_response.GetHeaders()) {</div>
<div class="line">            <a class="code hl_define" href="../../d9/d1d/testpoint_8hpp.html#a8a6d27a839e4327f705ac8d965e4b6e8" title="Send testpoint notification. Works only if testpoint support is enabled (e.g. in components::TestsCon...">TESTPOINT</a>(<span class="stringliteral">&quot;stream_after_get_headers&quot;</span>, {});</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; header_name = header_item.first;</div>
<div class="line">            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; header_value = header_item.second;</div>
<div class="line">            response_body_stream.SetHeader(header_name, header_value);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> status_code = client_response.StatusCode();</div>
<div class="line">        response_body_stream.SetStatusCode(status_code);</div>
<div class="line"> </div>
<div class="line">        response_body_stream.SetHeader(std::string{<span class="stringliteral">&quot;abc&quot;</span>}, std::string{<span class="stringliteral">&quot;def&quot;</span>});</div>
<div class="line">        response_body_stream.SetEndOfHeaders();</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_define" href="../../d9/d1d/testpoint_8hpp.html#a8a6d27a839e4327f705ac8d965e4b6e8" title="Send testpoint notification. Works only if testpoint support is enabled (e.g. in components::TestsCon...">TESTPOINT</a>(<span class="stringliteral">&quot;stream_after_set_end_of_headers&quot;</span>, {});</div>
<div class="line"> </div>
<div class="line">        std::string body_part;</div>
<div class="line">        <span class="keyword">auto</span> deadline = <a class="code hl_function" href="../../de/d6a/classengine_1_1Deadline.html#af4ebdc7f5c1074c2bbc559345b8a289f" title="Converts duration to a Deadline.">engine::Deadline::FromDuration</a>(std::chrono::seconds(10));</div>
<div class="line">        <span class="keywordflow">while</span> (client_response.ReadChunk(body_part, deadline)) {</div>
<div class="line">            <a class="code hl_define" href="../../d9/d1d/testpoint_8hpp.html#a8a6d27a839e4327f705ac8d965e4b6e8" title="Send testpoint notification. Works only if testpoint support is enabled (e.g. in components::TestsCon...">TESTPOINT</a>(<span class="stringliteral">&quot;stream_after_read_chunk&quot;</span>, {});</div>
<div class="line">            response_body_stream.PushBodyChunk(std::move(body_part), <a class="code hl_class" href="../../de/d6a/classengine_1_1Deadline.html" title="Internal representation of a deadline time point.">engine::Deadline</a>());</div>
<div class="line">            <a class="code hl_define" href="../../d9/d1d/testpoint_8hpp.html#a8a6d27a839e4327f705ac8d965e4b6e8" title="Send testpoint notification. Works only if testpoint support is enabled (e.g. in components::TestsCon...">TESTPOINT</a>(<span class="stringliteral">&quot;stream_after_push_body_chunk&quot;</span>, {});</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md323"></a>
HTTP version</h2>
<p>The HTTP server in userver supports versions <code>1.1</code> and <code>2.0</code>. The default version is <code>1.1</code>. You can enable version <code>2.0</code> in the static config such as: </p><div class="fragment"><div class="line"># yaml</div>
<div class="line">components_manager:</div>
<div class="line">    components:</div>
<div class="line">        # ... other components</div>
<div class="line">        server:</div>
<div class="line">            listener:</div>
<div class="line">                port: 8080</div>
<div class="line">                task_processor: main-task-processor</div>
<div class="line">                connection:</div>
<div class="line">                    http-version: &#39;2&#39; # enum `1.1` or `2`</div>
<div class="line">                    http2-session:</div>
<div class="line">                        max_concurrent_streams: 100</div>
<div class="line">                        max_frame_size: 16384</div>
<div class="line">                        initial_window_size: 65536</div>
</div><!-- fragment --><p> You can set some options specific to <code>HTTP/2.0</code> in the <code>http2-session</code> section. See docs for these options in <a class="el" href="../../d0/d0b/classcomponents_1_1Server.html" title="Component that listens for incoming requests, manages incoming connections and passes the requests to...">components::Server</a></p>
<h1><a class="anchor" id="autotoc_md324"></a>
Components</h1>
<ul>
<li><a class="el" href="../../d0/d0b/classcomponents_1_1Server.html">Server</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Oct 21 2024 13:55:59 for userver by
    <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.10.0</li>
  </ul>
</div>
<script type="text/javascript" src="../../codeHighlight.js"></script>
<script type="text/javascript" src="../../telegramLanguage.js"></script>
<script type="text/javascript" src="../../styledBtn.js"></script>
<script type="text/javascript" src="../../search.js"></script>
<script type="text/javascript" src="../../header.js"></script>
<script type="text/javascript" src="../../searchHighlight.js"></script>
<script>
  const addLinks = () =>  {
      const links = document.createElement('div')
      links.id = 'links';
      links.innerHTML = `
          <a href="https://github.com/userver-framework/" id='github_header' rel="noopener" target="_blank" class="titlelink">
              <img src="../../github_logo.svg" alt="Github" class="gh-logo"/>
          </a>
          <a href="https://t.me/userver_en" rel="noopener" id='telegram_channel' target="_blank" class="titlelink generic_tg_link">
              <img src="../../telegram_logo.svg" alt="Telegram"/>
          </a>
      `
      document.getElementById('main-navbar').appendChild(links);
  }
  $(function() {
    $(document).ready(function() {
      setTimeout(() => {
      init_all_results_button();
      init_search_hotkey();
      init_header();
      addLinks();
      changeTelegramChannelLanguageForRussianSpeakingUser();
      document.getElementById("side-nav").style.display = "none";
      const isLanding = document.getElementById('landing_logo_id') !== null;
      if (isLanding) return;
      highlight_code();
      styleNavButtons();
    }, 0);
    });
  });
</script>
<script type="module" src="../../toc.js"></script>
</body>
</html>
