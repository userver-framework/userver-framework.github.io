<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <!-- Yandex.Metrika counter -->
      <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(94541714, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
      </script>
      <noscript><div><img src="https://mc.yandex.ru/watch/94541714" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
      <!-- /Yandex.Metrika counter -->
      <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=9"/>
      <meta name="generator" content="Doxygen 1.10.0"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:image" content="../../logo_in_circle.png"/>
      <meta property="og:image:alt" content="userver logo"/>
      <link rel="icon" href="../../favicon.svg">
      <title>userver: storages::secdist::SecdistConfig Class Reference</title>
      <!-- Roboto fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <!-- Roboto fonts -->
      <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="../../jquery.js"></script>
      <!-- Highlight.js -->
      <link rel="stylesheet" href="../../highlightjs.css">
      <script src="../../highlight.min.js"></script>
      <!-- Highlight.js -->
      <!-- Roboto fonts -->
      <script type="text/javascript" src="../../dynsections.js"></script>
      <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
      <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
      <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
      <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
      <link rel="stylesheet" href="../../customdoxygen.css">
      <!-- Doxygen Awesome -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
      <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
        DoxygenAwesomeParagraphLink.init()
        DoxygenAwesomeInteractiveToc.topOffset = 180;
      </script>
      <!-- Doxygen Awesome -->
    </head>
    <body>
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0" style="width: 100%;">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
                <td id="projectalign">
                  <div id="projectname">
                    <a class="titlelink" href="../../index.html">userver
                    </a>
                  </div>
                  <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework</a></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('de/d15/classstorages_1_1secdist_1_1SecdistConfig.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="../../d0/d4e/classstorages_1_1secdist_1_1SecdistConfig-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">storages::secdist::SecdistConfig Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="../../de/d08/group__userver__clients.html">Clients</a></div></div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../dd/d27/secdist_8hpp_source.html">userver/storages/secdist/secdist.hpp</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Client to retrieve credentials from the <a class="el" href="../../da/dc7/classcomponents_1_1Secdist.html" title="Component that stores security related data (keys, passwords, ...).">components::Secdist</a>. </p>
<h2><a class="anchor" id="autotoc_md995"></a>
Example usage:</h2>
<p>Declare a type that would work with the credentials:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;userver/storages/secdist/provider_component.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dd/d27/secdist_8hpp.html" title="Client to retrieve credentials from the components::Secdist.">userver/storages/secdist/secdist.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/d55/algorithm_8hpp.html" title="Miscellaneous cryptographic routines.">userver/crypto/algorithm.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/d10/universal_2include_2userver_2formats_2parse_2common__containers_8hpp.html" title="Parsers and converters for Standard Library containers and std::optional.">userver/formats/parse/common_containers.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dc2/algo_8hpp.html" title="Small useful algorithms.">userver/utils/algo.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;userver/utils/strong_typedef.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>UserPasswords {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using </span>Password = <a class="code hl_class" href="../../d4/d67/classutils_1_1StrongTypedef.html" title="Strong typedef for a type T.">utils::NonLoggable&lt;class PasswordTag, std::string&gt;</a>;</div>
<div class="line"> </div>
<div class="line">    UserPasswords(<span class="keyword">const</span> <a class="code hl_class" href="../../de/d91/classformats_1_1json_1_1Value.html" title="Non-mutable JSON value representation.">formats::json::Value</a>&amp; doc)</div>
<div class="line">        : user_passwords_(doc[<span class="stringliteral">&quot;user-passwords&quot;</span>].As&lt;<a class="code hl_namespace" href="../../d8/dcc/namespacestd.html" title="STL namespace.">std</a>::optional&lt;Storage&gt;&gt;()) {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> IsMatching(<span class="keyword">const</span> std::string&amp; user, <span class="keyword">const</span> Password&amp; password)<span class="keyword"> const </span>{</div>
<div class="line">        <span class="keywordflow">if</span> (!user_passwords_.has_value()) {</div>
<div class="line">            <span class="keywordflow">throw</span> std::runtime_error(</div>
<div class="line">                <span class="stringliteral">&quot;User passwords storage is missing. Field &#39;user-passwords&#39; was &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;missing in json.&quot;</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span>* ptr = <a class="code hl_function" href="../../d6/d84/namespaceutils.html#a718d98173957dede88ba7ac2718a207a" title="Returns nullptr if no key in associative container, otherwise returns pointer to value.">utils::FindOrNullptr</a>(user_passwords_.value(), user);</div>
<div class="line">        <span class="keywordflow">return</span> ptr &amp;&amp; <a class="code hl_function" href="../../dd/d0e/namespacecrypto_1_1algorithm.html#a73264ac864b87f88e45312c6b44e5d98">crypto::algorithm::AreStringsEqualConstTime</a>(ptr-&gt;GetUnderlying(), password.GetUnderlying());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">using </span>Storage = std::unordered_map&lt;std::string, Password&gt;;</div>
<div class="line">    std::optional&lt;Storage&gt; user_passwords_;</div>
<div class="line">};</div>
</div><!-- fragment --><p>Fill the <a class="el" href="../../da/dc7/classcomponents_1_1Secdist.html" title="Component that stores security related data (keys, passwords, ...).">components::Secdist</a> <code>config</code> from file with the secure data:</p>
<div class="fragment"><div class="line"><span class="stringliteral">  {</span></div>
<div class="line"><span class="stringliteral">      &quot;user-passwords&quot;: {</span></div>
<div class="line"><span class="stringliteral">          &quot;username&quot;: &quot;password&quot;,</span></div>
<div class="line"><span class="stringliteral">          &quot;another username&quot;: &quot;another password&quot;</span></div>
<div class="line"><span class="stringliteral">      }</span></div>
<div class="line"><span class="stringliteral">  }</span></div>
</div><!-- fragment --><p>Retrieve <a class="el" href="../../de/d15/classstorages_1_1secdist_1_1SecdistConfig.html" title="Client to retrieve credentials from the components::Secdist.">SecdistConfig</a> from <a class="el" href="../../da/dc7/classcomponents_1_1Secdist.html" title="Component that stores security related data (keys, passwords, ...).">components::Secdist</a> and get the type from it:</p>
<div class="fragment"><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; user_passwords = secdist_config.Get&lt;UserPasswords&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> password = UserPasswords::Password{<span class="stringliteral">&quot;password&quot;</span>};</div>
<div class="line">    EXPECT_TRUE(user_passwords.IsMatching(<span class="stringliteral">&quot;username&quot;</span>, password));</div>
<div class="line">    EXPECT_FALSE(user_passwords.IsMatching(<span class="stringliteral">&quot;username2&quot;</span>, password));</div>
</div><!-- fragment --><p>Json with secure data can also be loaded from environment variable with name defined in <code>environment_secrets_key</code>. Sample variable value: <code>{"user-passwords":{"username":"password","another username":"another password"}}</code>. It has the same format as data from file. If both sources are presented, data from environment variable will be merged with data from file (json objects will be merged, duplicate fields of other types will be overridden by data from environment variable). </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="../../d9/d0c/samples_2digest_auth_service_2auth_digest_8cpp-example.html#_a2">samples/digest_auth_service/auth_digest.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dd/d27/secdist_8hpp_source.html#l00078">78</a> of file <a class="el" href="../../dd/d27/secdist_8hpp_source.html">secdist.hpp</a>.</p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d73/structstorages_1_1secdist_1_1SecdistConfig_1_1Settings.html">Settings</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa10a4f385ece0f3e06a12191bbb78b27" id="r_aa10a4f385ece0f3e06a12191bbb78b27"><td class="memItemLeft" align="right" valign="top"><a id="aa10a4f385ece0f3e06a12191bbb78b27" name="aa10a4f385ece0f3e06a12191bbb78b27"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>SecdistConfig</b> (const <a class="el" href="../../dd/d73/structstorages_1_1secdist_1_1SecdistConfig_1_1Settings.html">Settings</a> &amp;settings)</td></tr>
<tr class="separator:aa10a4f385ece0f3e06a12191bbb78b27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7461956afb21a32575823fbff63d938" id="r_ad7461956afb21a32575823fbff63d938"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ad7461956afb21a32575823fbff63d938"><td class="memTemplItemLeft" align="right" valign="top">const T &amp;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#ad7461956afb21a32575823fbff63d938">Get</a> () const</td></tr>
<tr class="separator:ad7461956afb21a32575823fbff63d938"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ac7bb96acac32bf7b81f5e72b89708659" id="r_ac7bb96acac32bf7b81f5e72b89708659"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ac7bb96acac32bf7b81f5e72b89708659"><td class="memTemplItemLeft" align="right" valign="top">static std::size_t&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#ac7bb96acac32bf7b81f5e72b89708659">Register</a> (std::function&lt; std::any(const <a class="el" href="../../de/d91/classformats_1_1json_1_1Value.html">formats::json::Value</a> &amp;)&gt; &amp;&amp;factory)</td></tr>
<tr class="separator:ac7bb96acac32bf7b81f5e72b89708659"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ad7461956afb21a32575823fbff63d938" name="ad7461956afb21a32575823fbff63d938"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7461956afb21a32575823fbff63d938">&#9670;&#160;</a></span>Get()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const T &amp; storages::secdist::SecdistConfig::Get </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d27/secdist_8hpp_source.html#l00094">94</a> of file <a class="el" href="../../dd/d27/secdist_8hpp_source.html">secdist.hpp</a>.</p>

</div>
</div>
<a id="ac7bb96acac32bf7b81f5e72b89708659" name="ac7bb96acac32bf7b81f5e72b89708659"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7bb96acac32bf7b81f5e72b89708659">&#9670;&#160;</a></span>Register()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static std::size_t storages::secdist::SecdistConfig::Register </td>
          <td>(</td>
          <td class="paramtype">std::function&lt; std::any(const <a class="el" href="../../de/d91/classformats_1_1json_1_1Value.html">formats::json::Value</a> &amp;)&gt; &amp;&amp;</td>          <td class="paramname"><span class="paramname"><em>factory</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dd/d27/secdist_8hpp_source.html#l00089">89</a> of file <a class="el" href="../../dd/d27/secdist_8hpp_source.html">secdist.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>userver/storages/secdist/<a class="el" href="../../dd/d27/secdist_8hpp_source.html">secdist.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d91/namespacestorages.html">storages</a></li><li class="navelem"><a class="el" href="../../d1/d49/namespacestorages_1_1secdist.html">secdist</a></li><li class="navelem"><a class="el" href="../../de/d15/classstorages_1_1secdist_1_1SecdistConfig.html">SecdistConfig</a></li>
    <li class="footer">Generated on Mon Oct 21 2024 13:56:09 for userver by
    <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.10.0</li>
  </ul>
</div>
<script type="text/javascript" src="../../codeHighlight.js"></script>
<script type="text/javascript" src="../../telegramLanguage.js"></script>
<script type="text/javascript" src="../../styledBtn.js"></script>
<script type="text/javascript" src="../../search.js"></script>
<script type="text/javascript" src="../../header.js"></script>
<script type="text/javascript" src="../../searchHighlight.js"></script>
<script>
  const addLinks = () =>  {
      const links = document.createElement('div')
      links.id = 'links';
      links.innerHTML = `
          <a href="https://github.com/userver-framework/" id='github_header' rel="noopener" target="_blank" class="titlelink">
              <img src="../../github_logo.svg" alt="Github" class="gh-logo"/>
          </a>
          <a href="https://t.me/userver_en" rel="noopener" id='telegram_channel' target="_blank" class="titlelink generic_tg_link">
              <img src="../../telegram_logo.svg" alt="Telegram"/>
          </a>
      `
      document.getElementById('main-navbar').appendChild(links);
  }
  $(function() {
    $(document).ready(function() {
      setTimeout(() => {
      init_all_results_button();
      init_search_hotkey();
      init_header();
      addLinks();
      changeTelegramChannelLanguageForRussianSpeakingUser();
      document.getElementById("side-nav").style.display = "none";
      const isLanding = document.getElementById('landing_logo_id') !== null;
      if (isLanding) return;
      highlight_code();
      styleNavButtons();
    }, 0);
    });
  });
</script>
<script type="module" src="../../toc.js"></script>
</body>
</html>
