<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <!-- Yandex.Metrika counter -->
      <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(94541714, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
      </script>
      <noscript><div><img src="https://mc.yandex.ru/watch/94541714" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
      <!-- /Yandex.Metrika counter -->
      <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=9"/>
      <meta name="generator" content="Doxygen 1.10.0"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:image" content="../../logo_in_circle.png"/>
      <meta property="og:image:alt" content="userver logo"/>
      <link rel="icon" href="../../favicon.svg">
      <title>userver: MongoDB</title>
      <!-- Roboto fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <!-- Roboto fonts -->
      <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="../../jquery.js"></script>
      <!-- Highlight.js -->
      <link rel="stylesheet" href="../../highlightjs.css">
      <script src="../../highlight.min.js"></script>
      <!-- Highlight.js -->
      <!-- Roboto fonts -->
      <script type="text/javascript" src="../../dynsections.js"></script>
      <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
      <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
      <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
      <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
      <link rel="stylesheet" href="../../customdoxygen.css">
      <!-- Doxygen Awesome -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
      <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
        DoxygenAwesomeParagraphLink.init()
        DoxygenAwesomeInteractiveToc.topOffset = 180;
      </script>
      <!-- Doxygen Awesome -->
    </head>
    <body>
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0" style="width: 100%;">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
                <td id="projectalign">
                  <div id="projectname">
                    <a class="titlelink" href="../../index.html">userver
                    </a>
                  </div>
                  <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework</a></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d7/d65/md_en_2userver_2mongodb.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MongoDB</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md397"></a> <b>Quality:</b> <a class="el" href="../../db/d57/md_en_2userver_2development_2stability.html#QUALITY_TIERS">Platinum Tier</a>.</p>
<p>The mongo asynchronous driver provides an interface to work with MongoDB databases and the BSON format.</p>
<h1><a class="anchor" id="autotoc_md398"></a>
Main features</h1>
<ul>
<li>Building and reading BSON documents with support for most of the C++ types;</li>
<li>Support for basic operations with collections via <a class="el" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html" title="MongoDB collection handle, the main way to operate with MongoDB.">storages::mongo::Collection</a>;</li>
<li>Support for bulk operations;</li>
<li>Dynamic management of database sets;</li>
<li>Aggregation support;</li>
<li>Timeouts;</li>
<li>Congestion control to work smoothly under heavy load and to restore from metastable failure state;</li>
<li><a class="el" href="../../d6/d64/md_en_2userver_2deadline__propagation.html">Deadline propagation</a> .</li>
</ul>
<h1><a class="anchor" id="autotoc_md399"></a>
Metrics</h1>
<p>Most important ones:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Metric name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.pool.current-size   </td><td class="markdownTableBodyNone">current number of open connections    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mongo.pool.max-size   </td><td class="markdownTableBodyNone">limit on the number of open connections    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.pool.overloads   </td><td class="markdownTableBodyNone">counter of requests that could not get a connection    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mongo.pool.queue-wait-timings   </td><td class="markdownTableBodyNone">waiting timings in the queue to receive a connection    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.pool.conn-request-timings   </td><td class="markdownTableBodyNone">connection receipt timings (includes queue-wait)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mongo.pool.conn-created/closed   </td><td class="markdownTableBodyNone">open/closed connection counters    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.success   </td><td class="markdownTableBodyNone">counter of successfully executed requests    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mongo.errors   </td><td class="markdownTableBodyNone">counter of failed requests    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.timings   </td><td class="markdownTableBodyNone">query timings   </td></tr>
</table>
<p>See <a class="el" href="../../d9/dac/md_en_2userver_2service__monitor.html">Service Statistics and Metrics (Prometheus/Graphite/...)</a> for info on how to get the metrics.</p>
<h1><a class="anchor" id="autotoc_md400"></a>
Usage</h1>
<p>To use MongoDB you have to add the component <a class="el" href="../../d0/dda/classcomponents_1_1Mongo.html" title="MongoDB client component.">components::Mongo</a> and configure it according to the documentation. After that you can work with a collection via <a class="el" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html" title="MongoDB collection handle, the main way to operate with MongoDB.">storages::mongo::Collection</a>:</p>
<div class="fragment"><div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> SampleMongoPool(<a class="code hl_class" href="../../d6/d08/classstorages_1_1mongo_1_1Pool.html" title="MongoDB client pool.">storages::mongo::Pool</a> pool) {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a9037c8402aa532f2c93c89d1e9f573ab" title="Constructs an array Value from provided element list.">formats::bson::MakeArray</a>;</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> in_coll = pool.<a class="code hl_function" href="../../d6/d08/classstorages_1_1mongo_1_1Pool.html#ab6378d692e4c3ffa74715dfeff4e362b" title="Returns a handle for the specified collection.">GetCollection</a>(<span class="stringliteral">&quot;aggregate_in&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    in_coll.<a class="code hl_function" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html#a11d9b53b7cda2261c9c2ab0a5cbe4b39" title="Inserts multiple documents into the collection.">InsertMany</a>({</div>
<div class="line">        <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, 1, <span class="stringliteral">&quot;x&quot;</span>, 0),</div>
<div class="line">        <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, 2, <span class="stringliteral">&quot;x&quot;</span>, 1),</div>
<div class="line">        <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, 3, <span class="stringliteral">&quot;x&quot;</span>, 2),</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> cursor = in_coll.Aggregate(</div>
<div class="line">        <a class="code hl_function" href="../../d3/dcb/group__userver__formats.html#gafc1e568ca1efc4014483f1bf319e105d">MakeArray</a>(</div>
<div class="line">            <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$match&quot;</span>, <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$gte&quot;</span>, 2))),</div>
<div class="line">            <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$addFields&quot;</span>, <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;check&quot;</span>, <span class="keyword">true</span>)),</div>
<div class="line">            <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$out&quot;</span>, <span class="stringliteral">&quot;aggregate_out&quot;</span>)</div>
<div class="line">        ),</div>
<div class="line">        <a class="code hl_enumvalue" href="../../dc/db5/classstorages_1_1mongo_1_1options_1_1ReadPreference.html#a86019ac0c8a7460ec91efa8641ebf470a275ad47b1408ba162fad465ea36e6bb8" title="read from secondary if available, fallback to primary">storages::mongo::options::ReadPreference::kSecondaryPreferred</a>,</div>
<div class="line">        <a class="code hl_enumvalue" href="../../d6/d38/classstorages_1_1mongo_1_1options_1_1WriteConcern.html#af85ddf2e778bc88f5ba462beaf1cfc75ab348f82d5527d54854937d056744d39d" title="Wait until propagation to a &quot;majority&quot; of RS nodes.">storages::mongo::options::WriteConcern::kMajority</a></div>
<div class="line">    );</div>
<div class="line">    EXPECT_FALSE(cursor);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> out_coll = pool.<a class="code hl_function" href="../../d6/d08/classstorages_1_1mongo_1_1Pool.html#ab6378d692e4c3ffa74715dfeff4e362b" title="Returns a handle for the specified collection.">GetCollection</a>(<span class="stringliteral">&quot;aggregate_out&quot;</span>);</div>
<div class="line">    EXPECT_EQ(2, out_coll.CountApprox());</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; doc : out_coll.Find({})) {</div>
<div class="line">        EXPECT_EQ(doc[<span class="stringliteral">&quot;_id&quot;</span>].As&lt;int&gt;(), doc[<span class="stringliteral">&quot;x&quot;</span>].As&lt;int&gt;() + 1);</div>
<div class="line">        EXPECT_TRUE(doc[<span class="stringliteral">&quot;check&quot;</span>].As&lt;bool&gt;());</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Methods and options correspond to <a href="https://docs.mongodb.com/manual/reference/method/#collection">the standard MongoDB Collections API</a>.</p>
<h2><a class="anchor" id="autotoc_md401"></a>
Timeouts</h2>
<p>It is recommended to set timeouts on the server side using <a class="el" href="../../d0/db6/classstorages_1_1mongo_1_1options_1_1MaxServerTime.html" title="Specifies the server-side time limit for the operation.">storages::mongo::options::MaxServerTime</a> as for other cancellation mechanisms MongoDB does not guarantee that the cancelled operation was not applied.</p>
<p>For client-side timeouts consider setting socket and/or connection timeouts in pool configuration as native task cancellation is not supported in the current implementation.</p>
<h2><a class="anchor" id="autotoc_md402"></a>
Write results</h2>
<p>Methods that modify a collection return an object <a class="el" href="../../d3/dc9/classstorages_1_1mongo_1_1WriteResult.html" title="MongoDB write operation result.">storages::mongo::WriteResult</a> containing information about the result of the operation:</p>
<div class="fragment"><div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UpdateOneDoc(<a class="code hl_class" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html" title="MongoDB collection handle, the main way to operate with MongoDB.">storages::mongo::Collection</a>&amp; coll) {</div>
<div class="line">    <span class="keyword">using </span><a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>;</div>
<div class="line">    <span class="keyword">auto</span> result = coll.<a class="code hl_function" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html#abaa7f51f342d3f26e598491ca86d7717" title="Updates a single matching document.">UpdateOne</a>(<a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, 1), <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$set&quot;</span>, <a class="code hl_function" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;x&quot;</span>, 10)));</div>
<div class="line"> </div>
<div class="line">    EXPECT_EQ(1, result.MatchedCount());</div>
<div class="line">    EXPECT_EQ(1, result.ModifiedCount());</div>
<div class="line">    EXPECT_EQ(0, result.UpsertedCount());</div>
<div class="line">    EXPECT_TRUE(result.UpsertedIds().empty());</div>
<div class="line">    EXPECT_TRUE(result.ServerErrors().empty());</div>
<div class="line">    EXPECT_TRUE(result.WriteConcernErrors().empty());</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md403"></a>
Packaging operations</h2>
<p>In cases where the same operation is performed with the same arguments many times, it can be stored into a variable and reused. The finished operation can be passed to the collection method <code>Execute()</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">inline</span> <span class="keyword">const</span> <a class="code hl_class" href="../../d0/d55/classstorages_1_1mongo_1_1operations_1_1Find.html" title="Retrieves documents matching the filter.">storages::mongo::operations::Find</a>&amp; Top3ScoresOp() {</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> kGetTop = [] {</div>
<div class="line">        <a class="code hl_class" href="../../d0/d55/classstorages_1_1mongo_1_1operations_1_1Find.html" title="Retrieves documents matching the filter.">storages::mongo::operations::Find</a> op({});</div>
<div class="line"> </div>
<div class="line">        op.SetOption(<a class="code hl_class" href="../../da/dd2/classstorages_1_1mongo_1_1options_1_1Sort.html" title="Sorts the results.">storages::mongo::options::Sort</a>{{</div>
<div class="line">            <span class="stringliteral">&quot;score&quot;</span>,</div>
<div class="line">            storages::mongo::options::Sort::kDescending,</div>
<div class="line">        }});</div>
<div class="line">        op.SetOption(<a class="code hl_class" href="../../d6/d6b/classstorages_1_1mongo_1_1options_1_1Limit.html" title="Specifies the number of documents to request from the server.">storages::mongo::options::Limit</a>{3});</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> op;</div>
<div class="line">    }();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> kGetTop;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">inline</span> std::string GetWinners(<a class="code hl_class" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html" title="MongoDB collection handle, the main way to operate with MongoDB.">storages::mongo::Collection</a>&amp; mongo_coll) {</div>
<div class="line">    std::string result;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; doc : mongo_coll.Execute(Top3ScoresOp())) {</div>
<div class="line">        result += doc[<span class="stringliteral">&quot;name&quot;</span>].As&lt;std::string&gt;(<span class="stringliteral">&quot;&lt;anonymous&gt;&quot;</span>) + <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md404"></a>
BSON</h2>
<p>BSON follows the common formats interface that is described in detail at <a class="el" href="../../d2/d20/md_en_2userver_2formats.html">Formats (JSON, YAML, BSON, ...)</a>.</p>
<p>Since BSON is a binary format, it is not human readable. Differences in the BSON and JSON formats type systems do not always allow you to perform conversions between them unambiguously. In this regard, we do not provide conversion functions between BSON and text formats by default, but they are available in &lt;<a class="el" href="../../d6/de5/mongo_2include_2userver_2formats_2bson_2serialize_8hpp.html" title="Textual serialization helpers.">userver/formats/bson/serialize.hpp</a>&gt;. These functions are provided without guarantees for the stability of the conversion, and are primarily intended for debugging.</p>
<h2><a class="anchor" id="autotoc_md405"></a>
Mongo Congestion Control</h2>
<p>Extra database load may lead to database overload. To protect Mongo from this happening userver has Congestion Control. In case of fast timings increase, the Congestion Control limits the number of concurrent connections to Mongo and eliminates the extra load. On the one hand, it leads to extra error responses, but on the other hand, it greatly lowers the timings of the rest of the database requests and helps Mongo to return to the normal state with lower response timings.</p>
<hr  />
<p> <div class="bottom-nav">  ⇦ <a class="el" href="../../d3/d6a/md_en_2userver_2ydb.html">YDB</a> | <a class="el" href="../../dd/dde/md_en_2userver_2redis.html">Redis</a> ⇨  </div>  </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Oct 21 2024 13:55:59 for userver by
    <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.10.0</li>
  </ul>
</div>
<script type="text/javascript" src="../../codeHighlight.js"></script>
<script type="text/javascript" src="../../telegramLanguage.js"></script>
<script type="text/javascript" src="../../styledBtn.js"></script>
<script type="text/javascript" src="../../search.js"></script>
<script type="text/javascript" src="../../header.js"></script>
<script type="text/javascript" src="../../searchHighlight.js"></script>
<script>
  const addLinks = () =>  {
      const links = document.createElement('div')
      links.id = 'links';
      links.innerHTML = `
          <a href="https://github.com/userver-framework/" id='github_header' rel="noopener" target="_blank" class="titlelink">
              <img src="../../github_logo.svg" alt="Github" class="gh-logo"/>
          </a>
          <a href="https://t.me/userver_en" rel="noopener" id='telegram_channel' target="_blank" class="titlelink generic_tg_link">
              <img src="../../telegram_logo.svg" alt="Telegram"/>
          </a>
      `
      document.getElementById('main-navbar').appendChild(links);
  }
  $(function() {
    $(document).ready(function() {
      setTimeout(() => {
      init_all_results_button();
      init_search_hotkey();
      init_header();
      addLinks();
      changeTelegramChannelLanguageForRussianSpeakingUser();
      document.getElementById("side-nav").style.display = "none";
      const isLanding = document.getElementById('landing_logo_id') !== null;
      if (isLanding) return;
      highlight_code();
      styleNavButtons();
    }, 0);
    });
  });
</script>
<script type="module" src="../../toc.js"></script>
</body>
</html>
