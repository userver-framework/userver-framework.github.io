<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <!-- Yandex.Metrika counter -->
      <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(94541714, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
      </script>
      <noscript><div><img src="https://mc.yandex.ru/watch/94541714" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
      <!-- /Yandex.Metrika counter -->
      <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=9"/>
      <meta name="generator" content="Doxygen 1.10.0"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:image" content="../../logo_in_circle.png"/>
      <meta property="og:image:alt" content="userver logo"/>
      <link rel="icon" href="../../favicon.svg">
      <title>userver: uPg: Typed PostgreSQL results</title>
      <!-- Roboto fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <!-- Roboto fonts -->
      <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="../../jquery.js"></script>
      <!-- Highlight.js -->
      <link rel="stylesheet" href="../../highlightjs.css">
      <script src="../../highlight.min.js"></script>
      <!-- Highlight.js -->
      <!-- Roboto fonts -->
      <script type="text/javascript" src="../../dynsections.js"></script>
      <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
      <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
      <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
      <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
      <link rel="stylesheet" href="../../customdoxygen.css">
      <!-- Doxygen Awesome -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
      <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
        DoxygenAwesomeParagraphLink.init()
        DoxygenAwesomeInteractiveToc.topOffset = 180;
      </script>
      <!-- Doxygen Awesome -->
    </head>
    <body>
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0" style="width: 100%;">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
                <td id="projectalign">
                  <div id="projectname">
                    <a class="titlelink" href="../../index.html">userver
                    </a>
                  </div>
                  <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework</a></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d2/d2f/pg_user_row_types.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">uPg: Typed PostgreSQL results</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="../../d0/d5b/classstorages_1_1postgres_1_1ResultSet.html" title="PostgreSQL result set.">ResultSet</a> provides access to a generic PostgreSQL result buffer wrapper with access to individual column buffers and means to parse the buffers into a certain type.</p>
<p>For a user that wishes to get the results in a form of a sequence or a container of C++ tuples or structures, the driver provides a way to coerce the generic result set into a typed result set or a container of tuples or structures that fulfill certain conditions.</p>
<p><a class="el" href="../../df/d29/classstorages_1_1postgres_1_1TypedResultSet.html">TypedResultSet</a> provides container interface for typed result rows for iteration or random access without converting all the result set at once. The iterators in the <a class="el" href="../../df/d29/classstorages_1_1postgres_1_1TypedResultSet.html">TypedResultSet</a> satisfy requirements for a constant RandomAccessIterator with the exception of dereferencing iterators.</p>
<dl class="section warning"><dt>Warning</dt><dd>The operator* of the iterators returns value (not a reference to it) and the iterators don't have the operator-&gt;.</dd></dl>
<dl class="section user"><dt>Data row extraction</dt><dd></dd></dl>
<p>The data rows can be obtained as:</p><ul>
<li>std::tuple;</li>
<li>aggregate class as is;</li>
<li>non-aggregate class with some augmentation.</li>
</ul>
<p>Data members of the tuple or the classes must be supported by the driver. For more information on supported data types please see <a class="el" href="../../dd/dad/md_en_2userver_2pg__types.html">uPg: Supported data types</a>.</p>
<dl class="section user"><dt>std::tuple.</dt><dd></dd></dl>
<p>The first option is to convert <a class="el" href="../../d0/d5b/classstorages_1_1postgres_1_1ResultSet.html" title="PostgreSQL result set.">ResultSet</a>'s row to std::tuples.</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>MyRowType = std::tuple&lt;int, string&gt;;</div>
<div class="line"><span class="keyword">auto</span> trx = ...;</div>
<div class="line"><span class="keyword">auto</span> generic_result = trx.Execute(<span class="stringliteral">&quot;select a, b from my_table&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> iteration = generic_result.AsSetOf&lt;MyRowType&gt;();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> row : iteration) {</div>
<div class="line">  <span class="keyword">static_assert</span>(std::is_same_v&lt;<span class="keyword">decltype</span>(row), MyRowType&gt;,</div>
<div class="line">      <span class="stringliteral">&quot;Iterate over tuples&quot;</span>);</div>
<div class="line">  <span class="keyword">auto</span> [a, b] = row;</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a = &quot;</span> &lt;&lt; a &lt;&lt; <span class="stringliteral">&quot;; b = &quot;</span> &lt;&lt; b &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> data = geric_result.AsContainer&lt;std::vector&lt;MyRowType&gt;&gt;();</div>
</div><!-- fragment --><dl class="section user"><dt>Aggregate classes.</dt><dd></dd></dl>
<p>A data row can be coerced to an aggregate class.</p>
<p>An aggregate class (C++03 8.5.1 §1) is a class that with no base classes, no protected or private non-static data members, no user-declared constructors and no virtual functions.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>MyRowType {</div>
<div class="line">  <span class="keywordtype">int</span> a;</div>
<div class="line">  std::string b;</div>
<div class="line">};</div>
<div class="line"><span class="keyword">auto</span> generic_result = trx.Execute(<span class="stringliteral">&quot;select a, b from my_table&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> iteration = generic_result.AsSetOf&lt;MyRowType&gt;();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> row : iteration) {</div>
<div class="line">  <span class="keyword">static_assert</span>(std::is_same_v&lt;<span class="keyword">decltype</span>(row), MyRowType&gt;,</div>
<div class="line">      <span class="stringliteral">&quot;Iterate over aggregate classes&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a = &quot;</span> &lt;&lt; row.a &lt;&lt; <span class="stringliteral">&quot;; b = &quot;</span> &lt;&lt; row.b &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> data = geric_result.AsContainer&lt;std::vector&lt;MyRowType&gt;&gt;();</div>
</div><!-- fragment --><dl class="section user"><dt>Non-aggregate classes.</dt><dd></dd></dl>
<p>Classes that do not satisfy the aggregate class requirements can be used to be created from data rows by providing additional <code>Introspect</code> non-static member function. The function should return a tuple of references to member data fields. The class must be default constructible.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyRowType {</div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">int</span> a_;</div>
<div class="line">  std::string b_;</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  MyRowType() = <span class="keywordflow">default</span>; <span class="comment">// default ctor is required</span></div>
<div class="line">  <span class="keyword">explicit</span> MyRowType(<span class="keywordtype">int</span> x);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> Introspect() {</div>
<div class="line">    <span class="keywordflow">return</span> std::tie(a_, b_);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">int</span> GetA() <span class="keyword">const</span>;</div>
<div class="line">  <span class="keyword">const</span> std::string&amp; GetB() <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> generic_result = trx.Execute(<span class="stringliteral">&quot;select a, b from my_table&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> iteration = generic_result.AsSetOf&lt;MyRowType&gt;();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> row : iteration) {</div>
<div class="line">  <span class="keyword">static_assert</span>(std::is_same_v&lt;<span class="keyword">decltype</span>(row), MyRowType&gt;,</div>
<div class="line">      <span class="stringliteral">&quot;Iterate over non-aggregate classes&quot;</span>);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;a = &quot;</span> &lt;&lt; row.GetA() &lt;&lt; <span class="stringliteral">&quot;; b = &quot;</span> &lt;&lt; row.GetB() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> data = geric_result.AsContainer&lt;std::vector&lt;MyRowType&gt;&gt;();</div>
</div><!-- fragment --> <dl class="section user"><dt>Single-column result set</dt><dd></dd></dl>
<p>A single-column result set can be used to extract directly to the column type. User types mapped to PostgreSQL will work as well. If you need to extract the whole row into such a structure, you will need to disambiguate the call with the kRowTag.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> string_set = generic_result.AsSetOf&lt;std::string&gt;();</div>
<div class="line">std::string s = string_set[0];</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> string_vec = generic_result.AsContainer&lt;std::vector&lt;std::string&gt;&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Extract first column into the composite type</span></div>
<div class="line"><span class="keyword">auto</span> foo_set = generic_result.AsSetOf&lt;FooBar&gt;();</div>
<div class="line"><span class="keyword">auto</span> foo_vec = generic_result.AsContainer&lt;std::vector&lt;FooBar&gt;&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Extract the whole row, disambiguation</span></div>
<div class="line"><span class="keyword">auto</span> foo_set = generic_result.AsSetOf&lt;FooBar&gt;(kRowTag);</div>
</div><!-- fragment --><hr  />
<p> <div class="bottom-nav">  ⇦ <a class="el" href="../../dd/dad/md_en_2userver_2pg__types.html">uPg: Supported data types</a> | <a class="el" href="../../d5/d8e/pg_errors.html">uPg: Postgres errors</a> ⇨  </div>  </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Oct 21 2024 13:56:00 for userver by
    <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.10.0</li>
  </ul>
</div>
<script type="text/javascript" src="../../codeHighlight.js"></script>
<script type="text/javascript" src="../../telegramLanguage.js"></script>
<script type="text/javascript" src="../../styledBtn.js"></script>
<script type="text/javascript" src="../../search.js"></script>
<script type="text/javascript" src="../../header.js"></script>
<script type="text/javascript" src="../../searchHighlight.js"></script>
<script>
  const addLinks = () =>  {
      const links = document.createElement('div')
      links.id = 'links';
      links.innerHTML = `
          <a href="https://github.com/userver-framework/" id='github_header' rel="noopener" target="_blank" class="titlelink">
              <img src="../../github_logo.svg" alt="Github" class="gh-logo"/>
          </a>
          <a href="https://t.me/userver_en" rel="noopener" id='telegram_channel' target="_blank" class="titlelink generic_tg_link">
              <img src="../../telegram_logo.svg" alt="Telegram"/>
          </a>
      `
      document.getElementById('main-navbar').appendChild(links);
  }
  $(function() {
    $(document).ready(function() {
      setTimeout(() => {
      init_all_results_button();
      init_search_hotkey();
      init_header();
      addLinks();
      changeTelegramChannelLanguageForRussianSpeakingUser();
      document.getElementById("side-nav").style.display = "none";
      const isLanding = document.getElementById('landing_logo_id') !== null;
      if (isLanding) return;
      highlight_code();
      styleNavButtons();
    }, 0);
    });
  });
</script>
<script type="module" src="../../toc.js"></script>
</body>
</html>
