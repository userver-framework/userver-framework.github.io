<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <!-- Yandex.Metrika counter -->
      <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(94541714, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
      </script>
      <noscript><div><img src="https://mc.yandex.ru/watch/94541714" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
      <!-- /Yandex.Metrika counter -->
      <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=9"/>
      <meta name="generator" content="Doxygen 1.10.0"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:image" content="../../logo_in_circle.png"/>
      <meta property="og:image:alt" content="userver logo"/>
      <link rel="icon" href="../../favicon.svg">
      <title>userver: ydb::DistLockComponentBase Class Reference</title>
      <!-- Roboto fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <!-- Roboto fonts -->
      <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="../../jquery.js"></script>
      <!-- Highlight.js -->
      <link rel="stylesheet" href="../../highlightjs.css">
      <script src="../../highlight.min.js"></script>
      <!-- Highlight.js -->
      <!-- Roboto fonts -->
      <script type="text/javascript" src="../../dynsections.js"></script>
      <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
      <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
      <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
      <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
      <link rel="stylesheet" href="../../customdoxygen.css">
      <!-- Doxygen Awesome -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
      <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
        DoxygenAwesomeParagraphLink.init()
        DoxygenAwesomeInteractiveToc.topOffset = 180;
      </script>
      <!-- Doxygen Awesome -->
    </head>
    <body>
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0" style="width: 100%;">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
                <td id="projectalign">
                  <div id="projectname">
                    <a class="titlelink" href="../../index.html">userver
                    </a>
                  </div>
                  <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework</a></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('da/d60/classydb_1_1DistLockComponentBase.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="../../da/ddd/classydb_1_1DistLockComponentBase-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">ydb::DistLockComponentBase Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span><div class="ingroups"><a class="el" href="../../dd/d1c/group__userver__components.html">Components</a> &#124; <a class="el" href="../../da/d0c/group__userver__base__classes.html">Base Classes</a></div></div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d5/dcf/ydb_2include_2userver_2ydb_2dist__lock_2component__base_8hpp_source.html">userver/ydb/dist_lock/component_base.hpp</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Base class for YDB-based distlock worker components. </p>
<p>A component that implements a distlock with lock in YDB. Inherit from <a class="el" href="../../da/d60/classydb_1_1DistLockComponentBase.html" title="Base class for YDB-based distlock worker components.">DistLockComponentBase</a> and implement <a class="el" href="#a878b5ce28c0288edbda21e772c2460c2">DoWork()</a>. Lock options are configured in static config.</p>
<p>The class must be used for infinite loop jobs.</p>
<h2><a class="anchor" id="autotoc_md1107"></a>
Static configuration example:</h2>
<div class="fragment"><div class="line">        # yaml</div>
<div class="line">        sample-dist-lock:</div>
<div class="line">            # Settings that might be used for a group of related distlock instances</div>
<div class="line">            database-settings:</div>
<div class="line">                # The key of the database within ydb component (NOT the actual database path)</div>
<div class="line">                dbname: sampledb</div>
<div class="line">                # Name of the coordination node within the database</div>
<div class="line">                coordination-node: sample-node</div>
<div class="line">            # Name of the semaphore within the coordination node</div>
<div class="line">            semaphore-name: sample-lock</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1108"></a>
Static options:</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">name   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Default value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">semaphore-name   </td><td class="markdownTableBodyNone">name of the semaphore within the coordination node   </td><td class="markdownTableBodyNone">&ndash;    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">database-settings.dbname   </td><td class="markdownTableBodyNone">the key of the database within ydb component (NOT the actual database path)   </td><td class="markdownTableBodyNone">&ndash;    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">database-settings.coordination-node   </td><td class="markdownTableBodyNone">name of the coordination node within the database   </td><td class="markdownTableBodyNone">&ndash;    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">initial-setup   </td><td class="markdownTableBodyNone">if true, then create the coordination node and the semaphore unless they already exist   </td><td class="markdownTableBodyNone">true    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">task-processor   </td><td class="markdownTableBodyNone">the name of the TaskProcessor for running DoWork   </td><td class="markdownTableBodyNone">main-task-processor    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">node-settings.session-grace-period   </td><td class="markdownTableBodyNone">the time after which the lock will be given to another host after a network failure   </td><td class="markdownTableBodyNone">10s    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">session-timeout   </td><td class="markdownTableBodyNone">for how long we will try to restore session after a network failure before dropping it   </td><td class="markdownTableBodyNone">5s    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">restart-session-delay   </td><td class="markdownTableBodyNone">backoff before attempting to reconnect session after it returns "permanent failure"   </td><td class="markdownTableBodyNone">1s    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">acquire-interval   </td><td class="markdownTableBodyNone">backoff before repeating a failed Acquire call   </td><td class="markdownTableBodyNone">100ms    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">restart-delay   </td><td class="markdownTableBodyNone">backoff before calling DoWork again after it returns or throws   </td><td class="markdownTableBodyNone">100ms    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">cancel-task-time-limit   </td><td class="markdownTableBodyNone">time, within which a cancelled DoWork is expected to finish   </td><td class="markdownTableBodyNone">5s   </td></tr>
</table>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d7/dc4/md_en_2userver_2periodics.html">Periodics and DistLocks</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d5/dcf/ydb_2include_2userver_2ydb_2dist__lock_2component__base_8hpp_source.html#l00055">55</a> of file <a class="el" href="../../d5/dcf/ydb_2include_2userver_2ydb_2dist__lock_2component__base_8hpp_source.html">component_base.hpp</a>.</p>
</div><div id="dynsection-0" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Inheritance diagram for ydb::DistLockComponentBase:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d7/d0f/classydb_1_1DistLockComponentBase__inherit__graph.svg" width="256" height="183"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<center><span class="legend">[<a target="top" href="../../graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a826f053d84a3004f6996bc224c2fa408" id="r_a826f053d84a3004f6996bc224c2fa408"><td class="memItemLeft" align="right" valign="top"><a id="a826f053d84a3004f6996bc224c2fa408" name="a826f053d84a3004f6996bc224c2fa408"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>DistLockComponentBase</b> (const <a class="el" href="../../db/dff/classcomponents_1_1ComponentConfig.html">components::ComponentConfig</a> &amp;, const <a class="el" href="../../da/db1/classcomponents_1_1ComponentContext.html">components::ComponentContext</a> &amp;)</td></tr>
<tr class="separator:a826f053d84a3004f6996bc224c2fa408"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac304f6fcfcc5270874521987ddd745cf" id="r_ac304f6fcfcc5270874521987ddd745cf"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac304f6fcfcc5270874521987ddd745cf">OwnsLock</a> () const noexcept</td></tr>
<tr class="memdesc:ac304f6fcfcc5270874521987ddd745cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the the current service instance owns the lock.  <br /></td></tr>
<tr class="separator:ac304f6fcfcc5270874521987ddd745cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad148d1c0cf0fe96407d799f5e75777cd" id="r_ad148d1c0cf0fe96407d799f5e75777cd"><td class="memItemLeft" align="right" valign="top">ComponentHealth&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db4/classcomponents_1_1ComponentBase.html#ad148d1c0cf0fe96407d799f5e75777cd">GetComponentHealth</a> () const override</td></tr>
<tr class="separator:ad148d1c0cf0fe96407d799f5e75777cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b5cb43003537f2f54b3efee2398fccd" id="r_a2b5cb43003537f2f54b3efee2398fccd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db4/classcomponents_1_1ComponentBase.html#a2b5cb43003537f2f54b3efee2398fccd">OnLoadingCancelled</a> () override</td></tr>
<tr class="separator:a2b5cb43003537f2f54b3efee2398fccd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60698393b10991e707fd0ef4b2fe7440" id="r_a60698393b10991e707fd0ef4b2fe7440"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db4/classcomponents_1_1ComponentBase.html#a60698393b10991e707fd0ef4b2fe7440">OnAllComponentsLoaded</a> () override</td></tr>
<tr class="separator:a60698393b10991e707fd0ef4b2fe7440"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51d6410c867fed6d943c9fd193eb3739" id="r_a51d6410c867fed6d943c9fd193eb3739"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db4/classcomponents_1_1ComponentBase.html#a51d6410c867fed6d943c9fd193eb3739">OnAllComponentsAreStopping</a> () override</td></tr>
<tr class="separator:a51d6410c867fed6d943c9fd193eb3739"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:afc5c336e3fddc5a20d89fc02f45879f4" id="r_afc5c336e3fddc5a20d89fc02f45879f4"><td class="memItemLeft" align="right" valign="top"><a id="afc5c336e3fddc5a20d89fc02f45879f4" name="afc5c336e3fddc5a20d89fc02f45879f4"></a>
static <a class="el" href="../../d1/d3e/structyaml__config_1_1Schema.html">yaml_config::Schema</a>&#160;</td><td class="memItemRight" valign="bottom"><b>GetStaticConfigSchema</b> ()</td></tr>
<tr class="separator:afc5c336e3fddc5a20d89fc02f45879f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-types" name="pro-types"></a>
Protected Types</h2></td></tr>
<tr class="memitem:afcb3c9d37d64cd42ee59caf345bb0cec" id="r_afcb3c9d37d64cd42ee59caf345bb0cec"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/db4/classcomponents_1_1ComponentBase.html#afcb3c9d37d64cd42ee59caf345bb0cec">LoggableComponentBase</a> = ComponentBase</td></tr>
<tr class="memdesc:afcb3c9d37d64cd42ee59caf345bb0cec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Legacy alias, use <a class="el" href="../../d7/db4/classcomponents_1_1ComponentBase.html">ComponentBase</a> instead.  <br /></td></tr>
<tr class="separator:afcb3c9d37d64cd42ee59caf345bb0cec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a878b5ce28c0288edbda21e772c2460c2" id="r_a878b5ce28c0288edbda21e772c2460c2"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a878b5ce28c0288edbda21e772c2460c2">DoWork</a> ()=0</td></tr>
<tr class="separator:a878b5ce28c0288edbda21e772c2460c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac598c765fb9b517057d8a84abeaddcca" id="r_ac598c765fb9b517057d8a84abeaddcca"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac598c765fb9b517057d8a84abeaddcca">DoWorkTestsuite</a> ()</td></tr>
<tr class="separator:ac598c765fb9b517057d8a84abeaddcca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90e7b6d7afed9b30e0cb762b550dfce0" id="r_a90e7b6d7afed9b30e0cb762b550dfce0"><td class="memItemLeft" align="right" valign="top"><a id="a90e7b6d7afed9b30e0cb762b550dfce0" name="a90e7b6d7afed9b30e0cb762b550dfce0"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Start</b> ()</td></tr>
<tr class="memdesc:a90e7b6d7afed9b30e0cb762b550dfce0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Must be called at the end of the constructor of the derived component. <br /></td></tr>
<tr class="separator:a90e7b6d7afed9b30e0cb762b550dfce0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85817f1bf93cbea41203521de9bc3a1a" id="r_a85817f1bf93cbea41203521de9bc3a1a"><td class="memItemLeft" align="right" valign="top"><a id="a85817f1bf93cbea41203521de9bc3a1a" name="a85817f1bf93cbea41203521de9bc3a1a"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Stop</b> () noexcept</td></tr>
<tr class="memdesc:a85817f1bf93cbea41203521de9bc3a1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Must be called in the destructor of the derived component. <br /></td></tr>
<tr class="separator:a85817f1bf93cbea41203521de9bc3a1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Typedef Documentation</h2>
<a id="afcb3c9d37d64cd42ee59caf345bb0cec" name="afcb3c9d37d64cd42ee59caf345bb0cec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcb3c9d37d64cd42ee59caf345bb0cec">&#9670;&#160;</a></span>LoggableComponentBase</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../d7/db4/classcomponents_1_1ComponentBase.html#afcb3c9d37d64cd42ee59caf345bb0cec">components::ComponentBase::LoggableComponentBase</a> = ComponentBase</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Legacy alias, use ComponentBase instead. </p>

<p class="definition">Definition at line <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html#l00067">67</a> of file <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html">component_base.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a878b5ce28c0288edbda21e772c2460c2" name="a878b5ce28c0288edbda21e772c2460c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a878b5ce28c0288edbda21e772c2460c2">&#9670;&#160;</a></span>DoWork()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void ydb::DistLockComponentBase::DoWork </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Override this function with anything that must be done under the lock.</p>
<dl class="section note"><dt>Note</dt><dd><code>DoWork</code> must honour task cancellation and stop ASAP when it is cancelled, otherwise brain split is possible (IOW, two different users do work assuming both of them hold the lock, which is not true).</dd>
<dd>
When DoWork exits for any reason, the lock is dropped, then after <code>restart-delay</code> the lock is attempted to be re-acquired (but by that time another host likely acquires the lock).</dd></dl>
<h2><a class="anchor" id="autotoc_md1109"></a>
Example implementation</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> SampleDistLock::DoWork() {</div>
<div class="line">    <span class="keywordflow">while</span> (!<a class="code hl_function" href="../../d2/d64/namespaceengine_1_1current__task.html#aed8fc1cdfd588f3973f5c9bc503c9986">engine::current_task::ShouldCancel</a>()) {</div>
<div class="line">        <span class="comment">// Start a new trace_id.</span></div>
<div class="line">        <span class="keyword">auto</span> span = <a class="code hl_function" href="../../d7/d1a/classtracing_1_1Span.html#a8b3e5aad73510c215bdaa7721bf5b45a">tracing::Span::MakeRootSpan</a>(<span class="stringliteral">&quot;sample-dist-lock&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// If Foo() or anything in DoWork() throws an exception,</span></div>
<div class="line">        <span class="comment">// DoWork() will be restarted in `restart-delay` seconds.</span></div>
<div class="line">        Foo();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check for cancellation after cpu-intensive Foo().</span></div>
<div class="line">        <span class="comment">// You must check for cancellation at least every</span></div>
<div class="line">        <span class="comment">// `cancel-task-time-limit`</span></div>
<div class="line">        <span class="comment">// seconds to have time to notice lock prolongation failure.</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d2/d64/namespaceengine_1_1current__task.html#aed8fc1cdfd588f3973f5c9bc503c9986">engine::current_task::ShouldCancel</a>()) <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        Bar();</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="../../dc/d3f/namespaceengine.html#a19462f750672c6fa7f5f690c2575b9f6">engine::InterruptibleSleepFor</a>(config_source_.GetCopy(kSampleDistLockIntervalMs));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a id="ac598c765fb9b517057d8a84abeaddcca" name="ac598c765fb9b517057d8a84abeaddcca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac598c765fb9b517057d8a84abeaddcca">&#9670;&#160;</a></span>DoWorkTestsuite()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void ydb::DistLockComponentBase::DoWorkTestsuite </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Override this function to provide a custom testsuite handler, e.g. one that does not contain a "while not cancelled" loop. Calls <code>DoWork</code> by default.</p>
<p>In testsuite runs, the normal DoWork execution disabled by default. There is an API to call DoWorkTestsuite from testsuite, imitating waiting until DoWork runs:</p>
<div class="fragment"></div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="../../d5/dcf/ydb_2include_2userver_2ydb_2dist__lock_2component__base_8hpp_source.html#l00099">99</a> of file <a class="el" href="../../d5/dcf/ydb_2include_2userver_2ydb_2dist__lock_2component__base_8hpp_source.html">component_base.hpp</a>.</p>

</div>
</div>
<a id="ad148d1c0cf0fe96407d799f5e75777cd" name="ad148d1c0cf0fe96407d799f5e75777cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad148d1c0cf0fe96407d799f5e75777cd">&#9670;&#160;</a></span>GetComponentHealth()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ComponentHealth components::ComponentBase::GetComponentHealth </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Override this function to inform the world of the state of your component.</p>
<dl class="section warning"><dt>Warning</dt><dd>The function is called concurrently from multiple threads. </dd></dl>

<p>Reimplemented from <a class="el" href="../../d2/d86/classcomponents_1_1RawComponentBase.html">components::RawComponentBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html#l00035">35</a> of file <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html">component_base.hpp</a>.</p>

</div>
</div>
<a id="a51d6410c867fed6d943c9fd193eb3739" name="a51d6410c867fed6d943c9fd193eb3739"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51d6410c867fed6d943c9fd193eb3739">&#9670;&#160;</a></span>OnAllComponentsAreStopping()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void components::ComponentBase::OnAllComponentsAreStopping </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Component may use this function to stop doing work before the stop of the components that depend on it.</p>
<p>Base components may override it and make <code>final</code> to do some work before the derived object constructor is called. Don't use it otherwise. </p>

<p>Reimplemented from <a class="el" href="../../d2/d86/classcomponents_1_1RawComponentBase.html">components::RawComponentBase</a>.</p>

<p>Reimplemented in <a class="el" href="../../d8/d65/classurabbitmq_1_1ConsumerComponentBase.html#aedc18c2554dffb0e84b93c29eee667b3">urabbitmq::ConsumerComponentBase</a>, and <a class="el" href="../../d0/d0b/classcomponents_1_1Server.html#a6fb9bddd9811fd20819fa63c3d267f3c">components::Server</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html#l00058">58</a> of file <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html">component_base.hpp</a>.</p>

</div>
</div>
<a id="a60698393b10991e707fd0ef4b2fe7440" name="a60698393b10991e707fd0ef4b2fe7440"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60698393b10991e707fd0ef4b2fe7440">&#9670;&#160;</a></span>OnAllComponentsLoaded()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void components::ComponentBase::OnAllComponentsLoaded </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Component may use this function to finalize registration of other components that depend on it (for example, handler components register in server component, and the latter uses <a class="el" href="../../d7/db4/classcomponents_1_1ComponentBase.html#a60698393b10991e707fd0ef4b2fe7440">OnAllComponentsLoaded()</a> to start processing requests).</p>
<p>Base components may override it and make <code>final</code> to do some work after the derived object constructor is called. Don't use it otherwise. </p>

<p>Reimplemented from <a class="el" href="../../d2/d86/classcomponents_1_1RawComponentBase.html">components::RawComponentBase</a>.</p>

<p>Reimplemented in <a class="el" href="../../d8/d65/classurabbitmq_1_1ConsumerComponentBase.html#a6b243001b9a807f880078ed541c2c0aa">urabbitmq::ConsumerComponentBase</a>, <a class="el" href="../../d0/d0b/classcomponents_1_1Server.html#a3729deb39a876f7030f21ec76390ce93">components::Server</a>, and <a class="el" href="../../d7/d6d/classserver_1_1handlers_1_1Ping.html#a2e7db6573b62556421bd052fcbd0c2c2">server::handlers::Ping</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html#l00051">51</a> of file <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html">component_base.hpp</a>.</p>

</div>
</div>
<a id="a2b5cb43003537f2f54b3efee2398fccd" name="a2b5cb43003537f2f54b3efee2398fccd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b5cb43003537f2f54b3efee2398fccd">&#9670;&#160;</a></span>OnLoadingCancelled()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void components::ComponentBase::OnLoadingCancelled </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span><span class="mlabel">inherited</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Called once if the creation of any other component failed. If the current component expects some other component to take any action with the current component, this call is a signal that such action may never happen due to components loading was cancelled. Application components might not want to override it. </p>

<p>Reimplemented from <a class="el" href="../../d2/d86/classcomponents_1_1RawComponentBase.html">components::RawComponentBase</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html#l00042">42</a> of file <a class="el" href="../../d2/d2c/core_2include_2userver_2components_2component__base_8hpp_source.html">component_base.hpp</a>.</p>

</div>
</div>
<a id="ac304f6fcfcc5270874521987ddd745cf" name="ac304f6fcfcc5270874521987ddd745cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac304f6fcfcc5270874521987ddd745cf">&#9670;&#160;</a></span>OwnsLock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ydb::DistLockComponentBase::OwnsLock </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Checks if the the current service instance owns the lock. </p>
<p>Useful for:</p>
<ol type="1">
<li>Writing metrics only on the primary (for the given distlock) host.</li>
<li>Running on-demand work, e.g. in handlers, only on the primary host. The work must be short-lived (single requests with small timeout), otherwise brain split (where multiple hosts consider themselves primary) is possible. </li>
</ol>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>userver/ydb/dist_lock/<a class="el" href="../../d5/dcf/ydb_2include_2userver_2ydb_2dist__lock_2component__base_8hpp_source.html">component_base.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>ydb</b></li><li class="navelem"><a class="el" href="../../da/d60/classydb_1_1DistLockComponentBase.html">DistLockComponentBase</a></li>
    <li class="footer">Generated on Mon Oct 21 2024 13:56:11 for userver by
    <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.10.0</li>
  </ul>
</div>
<script type="text/javascript" src="../../codeHighlight.js"></script>
<script type="text/javascript" src="../../telegramLanguage.js"></script>
<script type="text/javascript" src="../../styledBtn.js"></script>
<script type="text/javascript" src="../../search.js"></script>
<script type="text/javascript" src="../../header.js"></script>
<script type="text/javascript" src="../../searchHighlight.js"></script>
<script>
  const addLinks = () =>  {
      const links = document.createElement('div')
      links.id = 'links';
      links.innerHTML = `
          <a href="https://github.com/userver-framework/" id='github_header' rel="noopener" target="_blank" class="titlelink">
              <img src="../../github_logo.svg" alt="Github" class="gh-logo"/>
          </a>
          <a href="https://t.me/userver_en" rel="noopener" id='telegram_channel' target="_blank" class="titlelink generic_tg_link">
              <img src="../../telegram_logo.svg" alt="Telegram"/>
          </a>
      `
      document.getElementById('main-navbar').appendChild(links);
  }
  $(function() {
    $(document).ready(function() {
      setTimeout(() => {
      init_all_results_button();
      init_search_hotkey();
      init_header();
      addLinks();
      changeTelegramChannelLanguageForRussianSpeakingUser();
      document.getElementById("side-nav").style.display = "none";
      const isLanding = document.getElementById('landing_logo_id') !== null;
      if (isLanding) return;
      highlight_code();
      styleNavButtons();
    }, 0);
    });
  });
</script>
<script type="module" src="../../toc.js"></script>
</body>
</html>
