<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <!-- Yandex.Metrika counter -->
      <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(94541714, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
      </script>
      <noscript><div><img src="https://mc.yandex.ru/watch/94541714" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
      <!-- /Yandex.Metrika counter -->
      <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=9"/>
      <meta name="generator" content="Doxygen 1.10.0"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:image" content="../../logo_in_circle.png"/>
      <meta property="og:image:alt" content="userver logo"/>
      <link rel="icon" href="../../favicon.svg">
      <title>userver: kafka::Producer Class Reference</title>
      <!-- Roboto fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <!-- Roboto fonts -->
      <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="../../jquery.js"></script>
      <!-- Highlight.js -->
      <link rel="stylesheet" href="../../highlightjs.css">
      <script src="../../highlight.min.js"></script>
      <!-- Highlight.js -->
      <!-- Roboto fonts -->
      <script type="text/javascript" src="../../dynsections.js"></script>
      <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
      <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
      <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
      <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
      <link rel="stylesheet" href="../../customdoxygen.css">
      <!-- Doxygen Awesome -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
      <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
        DoxygenAwesomeParagraphLink.init()
        DoxygenAwesomeInteractiveToc.topOffset = 180;
      </script>
      <!-- Doxygen Awesome -->
    </head>
    <body>
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0" style="width: 100%;">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
                <td id="projectalign">
                  <div id="projectname">
                    <a class="titlelink" href="../../index.html">userver
                    </a>
                  </div>
                  <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework</a></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('da/df0/classkafka_1_1Producer.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="../../d9/d9c/classkafka_1_1Producer-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">kafka::Producer Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="../../de/d08/group__userver__clients.html">Clients</a></div></div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../df/dd7/producer_8hpp_source.html">userver/kafka/producer.hpp</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Apache Kafka <a class="el" href="../../da/df0/classkafka_1_1Producer.html" title="Apache Kafka Producer Client.">Producer</a> Client. </p>
<p>It exposes the API to send an arbitrary message to the Kafka Broker to certain topic by given key and optional partition.</p>
<h2><a class="anchor" id="autotoc_md1093"></a>
Important implementation details</h2>
<p><a class="el" href="../../d3/dcd/classkafka_1_1Message.html" title="Wrapper for polled message data access.">Message</a> send tasks handling other messages' delivery reports, suspending their execution while no events exist. This makes message production parallel and leads to high <a class="el" href="../../da/df0/classkafka_1_1Producer.html" title="Apache Kafka Producer Client.">Producer</a> scalability.</p>
<p><a class="el" href="../../da/df0/classkafka_1_1Producer.html" title="Apache Kafka Producer Client.">Producer</a> maintains per topic statistics including the broker connection errors.</p>
<dl class="section remark"><dt>Remarks</dt><dd>Destructor may wait for no more than a 2 x <code>delivery_timeout</code> to ensure all sent messages are properly delivered.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a href="https://docs.confluent.io/platform/current/clients/producer.html">https://docs.confluent.io/platform/current/clients/producer.html</a> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="../../d9/d3e/samples_2kafka_service_2src_2produce_8cpp-example.html#_a0">samples/kafka_service/src/produce.cpp</a>, <a class="el" href="../../d5/d56/samples_2kafka_service_2src_2produce_8hpp-example.html#_a0">samples/kafka_service/src/produce.hpp</a>, and <a class="el" href="../../d6/d72/samples_2kafka_service_2src_2producer_handler_8hpp-example.html#_a6">samples/kafka_service/src/producer_handler.hpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../df/dd7/producer_8hpp_source.html#l00046">46</a> of file <a class="el" href="../../df/dd7/producer_8hpp_source.html">producer.hpp</a>.</p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a6824f7a5f126b2b61f8b84105a95b291" id="r_a6824f7a5f126b2b61f8b84105a95b291"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6824f7a5f126b2b61f8b84105a95b291">Producer</a> (const std::string &amp;name, engine::TaskProcessor &amp;producer_task_processor, const impl::ProducerConfiguration &amp;configuration, const impl::Secret &amp;secrets)</td></tr>
<tr class="memdesc:a6824f7a5f126b2b61f8b84105a95b291"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates the Kafka <a class="el" href="../../da/df0/classkafka_1_1Producer.html" title="Apache Kafka Producer Client.">Producer</a>.  <br /></td></tr>
<tr class="separator:a6824f7a5f126b2b61f8b84105a95b291"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d92def87141aaee8119c9568dfd42fc" id="r_a1d92def87141aaee8119c9568dfd42fc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1d92def87141aaee8119c9568dfd42fc">~Producer</a> ()</td></tr>
<tr class="memdesc:a1d92def87141aaee8119c9568dfd42fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Waits until all messages are sent for at most 2 x <code>delivery_timeout</code> and destroys the producer.  <br /></td></tr>
<tr class="separator:a1d92def87141aaee8119c9568dfd42fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa31bc0361bebda1260a1969629e1eeae" id="r_aa31bc0361bebda1260a1969629e1eeae"><td class="memItemLeft" align="right" valign="top"><a id="aa31bc0361bebda1260a1969629e1eeae" name="aa31bc0361bebda1260a1969629e1eeae"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>Producer</b> (const <a class="el" href="../../da/df0/classkafka_1_1Producer.html">Producer</a> &amp;)=delete</td></tr>
<tr class="separator:aa31bc0361bebda1260a1969629e1eeae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba5094d18d6d3105be4cf009ffb3429b" id="r_aba5094d18d6d3105be4cf009ffb3429b"><td class="memItemLeft" align="right" valign="top"><a id="aba5094d18d6d3105be4cf009ffb3429b" name="aba5094d18d6d3105be4cf009ffb3429b"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>Producer</b> (<a class="el" href="../../da/df0/classkafka_1_1Producer.html">Producer</a> &amp;&amp;)=delete</td></tr>
<tr class="separator:aba5094d18d6d3105be4cf009ffb3429b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af72571b2c650e2754da7296ca233d18e" id="r_af72571b2c650e2754da7296ca233d18e"><td class="memItemLeft" align="right" valign="top"><a id="af72571b2c650e2754da7296ca233d18e" name="af72571b2c650e2754da7296ca233d18e"></a>
<a class="el" href="../../da/df0/classkafka_1_1Producer.html">Producer</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (const <a class="el" href="../../da/df0/classkafka_1_1Producer.html">Producer</a> &amp;)=delete</td></tr>
<tr class="separator:af72571b2c650e2754da7296ca233d18e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43d971c3c5be32419714b842dc4599ee" id="r_a43d971c3c5be32419714b842dc4599ee"><td class="memItemLeft" align="right" valign="top"><a id="a43d971c3c5be32419714b842dc4599ee" name="a43d971c3c5be32419714b842dc4599ee"></a>
<a class="el" href="../../da/df0/classkafka_1_1Producer.html">Producer</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (<a class="el" href="../../da/df0/classkafka_1_1Producer.html">Producer</a> &amp;&amp;)=delete</td></tr>
<tr class="separator:a43d971c3c5be32419714b842dc4599ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2827db3ef18a1ff3c2308437cabd9b0f" id="r_a2827db3ef18a1ff3c2308437cabd9b0f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2827db3ef18a1ff3c2308437cabd9b0f">Send</a> (const std::string &amp;topic_name, std::string_view key, std::string_view message, std::optional&lt; std::uint32_t &gt; partition=std::nullopt) const</td></tr>
<tr class="memdesc:a2827db3ef18a1ff3c2308437cabd9b0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends given message to topic <code>topic_name</code> by given <code>key</code> and <code>partition</code> (if passed) with payload contains the <code>message</code> data. Asynchronously waits until the message is delivered or the delivery error occurred.  <br /></td></tr>
<tr class="separator:a2827db3ef18a1ff3c2308437cabd9b0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a935ddaa3f4ea1926a7b087e1bcdcb40c" id="r_a935ddaa3f4ea1926a7b087e1bcdcb40c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d80/classengine_1_1TaskWithResult.html">engine::TaskWithResult</a>&lt; void &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a935ddaa3f4ea1926a7b087e1bcdcb40c">SendAsync</a> (std::string topic_name, std::string key, std::string message, std::optional&lt; std::uint32_t &gt; partition=std::nullopt) const</td></tr>
<tr class="memdesc:a935ddaa3f4ea1926a7b087e1bcdcb40c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Same as <a class="el" href="#a2827db3ef18a1ff3c2308437cabd9b0f" title="Sends given message to topic topic_name by given key and partition (if passed) with payload contains ...">Producer::Send</a>, but returns the task which can be used to wait the message delivery manually.  <br /></td></tr>
<tr class="separator:a935ddaa3f4ea1926a7b087e1bcdcb40c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1db9a7987efe3012edaf4cd81272dc7a" id="r_a1db9a7987efe3012edaf4cd81272dc7a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1db9a7987efe3012edaf4cd81272dc7a">DumpMetric</a> (<a class="el" href="../../d7/dd9/classutils_1_1statistics_1_1Writer.html">utils::statistics::Writer</a> &amp;writer) const</td></tr>
<tr class="memdesc:a1db9a7987efe3012edaf4cd81272dc7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dumps per topic messages produce statistics. No expected to be called manually.  <br /></td></tr>
<tr class="separator:a1db9a7987efe3012edaf4cd81272dc7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a6824f7a5f126b2b61f8b84105a95b291" name="a6824f7a5f126b2b61f8b84105a95b291"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6824f7a5f126b2b61f8b84105a95b291">&#9670;&#160;</a></span>Producer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kafka::Producer::Producer </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">engine::TaskProcessor &amp;</td>          <td class="paramname"><span class="paramname"><em>producer_task_processor</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const impl::ProducerConfiguration &amp;</td>          <td class="paramname"><span class="paramname"><em>configuration</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const impl::Secret &amp;</td>          <td class="paramname"><span class="paramname"><em>secrets</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates the Kafka <a class="el" href="../../da/df0/classkafka_1_1Producer.html" title="Apache Kafka Producer Client.">Producer</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">producer_task_processor</td><td>is task processor where producer creates tasks for message delivery scheduling and waiting. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1d92def87141aaee8119c9568dfd42fc" name="a1d92def87141aaee8119c9568dfd42fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d92def87141aaee8119c9568dfd42fc">&#9670;&#160;</a></span>~Producer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">kafka::Producer::~Producer </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Waits until all messages are sent for at most 2 x <code>delivery_timeout</code> and destroys the producer. </p>
<dl class="section remark"><dt>Remarks</dt><dd>In a basic producer use cases, the destructor returns immediately. </dd></dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a1db9a7987efe3012edaf4cd81272dc7a" name="a1db9a7987efe3012edaf4cd81272dc7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1db9a7987efe3012edaf4cd81272dc7a">&#9670;&#160;</a></span>DumpMetric()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kafka::Producer::DumpMetric </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d7/dd9/classutils_1_1statistics_1_1Writer.html">utils::statistics::Writer</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>writer</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dumps per topic messages produce statistics. No expected to be called manually. </p>
<dl class="section see"><dt>See also</dt><dd>kafka/impl/stats.hpp </dd></dl>

</div>
</div>
<a id="a2827db3ef18a1ff3c2308437cabd9b0f" name="a2827db3ef18a1ff3c2308437cabd9b0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2827db3ef18a1ff3c2308437cabd9b0f">&#9670;&#160;</a></span>Send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kafka::Producer::Send </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>topic_name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string_view</td>          <td class="paramname"><span class="paramname"><em>key</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string_view</td>          <td class="paramname"><span class="paramname"><em>message</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::optional&lt; std::uint32_t &gt;</td>          <td class="paramname"><span class="paramname"><em>partition</em><span class="paramdefsep"> = </span><span class="paramdefval">std::nullopt</span></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends given message to topic <code>topic_name</code> by given <code>key</code> and <code>partition</code> (if passed) with payload contains the <code>message</code> data. Asynchronously waits until the message is delivered or the delivery error occurred. </p>
<p>No payload data is copied. Method holds the data until message is delivered.</p>
<p>Thread-safe and can be called from any number of threads concurrently.</p>
<p>If <code>partition</code> not passed, partition is chosen by internal Kafka partitioner.</p>
<dl class="section warning"><dt>Warning</dt><dd>if <code>enable_idempotence</code> option is enabled, do not use both explicit partitions and Kafka-chosen ones.</dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="../../dd/d5a/classkafka_1_1SendException.html" title="Base exception thrown by Producer::Send and Producer::SendAsync on send or delivery errors.">SendException</a></td><td>and its descendants if message is not delivered and acked by Kafka Broker in configured timeout.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Use <a class="el" href="../../dd/d5a/classkafka_1_1SendException.html#aeae29e728c244a9fb94b8d783bbbb3ea" title="Returns whether it makes sense to retry failed send.">SendException::IsRetryable</a> method to understand whether there is a sense to retry the message sending. <div class="fragment"><div class="line">    <span class="keywordtype">bool</span> delivered{<span class="keyword">false</span>};</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> deadline = <a class="code hl_function" href="../../de/d6a/classengine_1_1Deadline.html#af4ebdc7f5c1074c2bbc559345b8a289f" title="Converts duration to a Deadline.">engine::Deadline::FromDuration</a>(producer_configuration.delivery_timeout);</div>
<div class="line">    <span class="keywordflow">while</span> (!delivered &amp;&amp; !deadline.IsReached()) {</div>
<div class="line">        <span class="keywordflow">try</span> {</div>
<div class="line">            make_send_request();</div>
<div class="line">            delivered = <span class="keyword">true</span>;</div>
<div class="line">        } <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code hl_class" href="../../dd/d5a/classkafka_1_1SendException.html" title="Base exception thrown by Producer::Send and Producer::SendAsync on send or delivery errors.">kafka::SendException</a>&amp; e) {</div>
<div class="line">            <span class="keywordflow">if</span> (e.<a class="code hl_function" href="../../dd/d5a/classkafka_1_1SendException.html#aeae29e728c244a9fb94b8d783bbbb3ea" title="Returns whether it makes sense to retry failed send.">IsRetryable</a>()) {</div>
<div class="line">                <a class="code hl_function" href="../../dc/d3f/namespaceengine.html#a19462f750672c6fa7f5f690c2575b9f6">engine::InterruptibleSleepFor</a>(std::chrono::milliseconds{10});</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --> </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="../../d9/d3e/samples_2kafka_service_2src_2produce_8cpp-example.html#a1">samples/kafka_service/src/produce.cpp</a>.</dd>
</dl>

</div>
</div>
<a id="a935ddaa3f4ea1926a7b087e1bcdcb40c" name="a935ddaa3f4ea1926a7b087e1bcdcb40c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a935ddaa3f4ea1926a7b087e1bcdcb40c">&#9670;&#160;</a></span>SendAsync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d80/classengine_1_1TaskWithResult.html">engine::TaskWithResult</a>&lt; void &gt; kafka::Producer::SendAsync </td>
          <td>(</td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>topic_name</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>key</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>message</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::optional&lt; std::uint32_t &gt;</td>          <td class="paramname"><span class="paramname"><em>partition</em><span class="paramdefsep"> = </span><span class="paramdefval">std::nullopt</span></span>&#160;) const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Same as <a class="el" href="#a2827db3ef18a1ff3c2308437cabd9b0f" title="Sends given message to topic topic_name by given key and partition (if passed) with payload contains ...">Producer::Send</a>, but returns the task which can be used to wait the message delivery manually. </p>
<dl class="section warning"><dt>Warning</dt><dd>If user schedules a batch of send requests with <a class="el" href="#a935ddaa3f4ea1926a7b087e1bcdcb40c" title="Same as Producer::Send, but returns the task which can be used to wait the message delivery manually.">Producer::SendAsync</a>, some send requests may be retried by the library (for instance, in case of network blink). Though, the order messages are written to partition may differ from the order messages are initially sent <div class="fragment"><div class="line">    std::vector&lt;engine::TaskWithResult&lt;void&gt;&gt; results;</div>
<div class="line">    results.reserve(kSendCount);</div>
<div class="line">    <span class="keywordflow">for</span> (std::size_t send{0}; send &lt; kSendCount; ++send) {</div>
<div class="line">        results.emplace_back(</div>
<div class="line">            producer.SendAsync(topic, fmt::format(<span class="stringliteral">&quot;test-key-{}&quot;</span>, send), fmt::format(<span class="stringliteral">&quot;test-msg-{}&quot;</span>, send))</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="../../d1/db2/group__userver__utest.html#gafdf4f737b3561621eff19fb93f9c27fd">UEXPECT_NO_THROW</a>(<a class="code hl_function" href="../../dc/db7/group__userver__concurrency.html#gae7a0b9edf6e9e23e3433edafc6d59279" title="Waits for the successful completion of all of the specified tasks or for the cancellation of the call...">engine::WaitAllChecked</a>(results));</div>
</div><!-- fragment --> </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>userver/kafka/<a class="el" href="../../df/dd7/producer_8hpp_source.html">producer.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>kafka</b></li><li class="navelem"><a class="el" href="../../da/df0/classkafka_1_1Producer.html">Producer</a></li>
    <li class="footer">Generated on Mon Oct 21 2024 13:56:04 for userver by
    <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.10.0</li>
  </ul>
</div>
<script type="text/javascript" src="../../codeHighlight.js"></script>
<script type="text/javascript" src="../../telegramLanguage.js"></script>
<script type="text/javascript" src="../../styledBtn.js"></script>
<script type="text/javascript" src="../../search.js"></script>
<script type="text/javascript" src="../../header.js"></script>
<script type="text/javascript" src="../../searchHighlight.js"></script>
<script>
  const addLinks = () =>  {
      const links = document.createElement('div')
      links.id = 'links';
      links.innerHTML = `
          <a href="https://github.com/userver-framework/" id='github_header' rel="noopener" target="_blank" class="titlelink">
              <img src="../../github_logo.svg" alt="Github" class="gh-logo"/>
          </a>
          <a href="https://t.me/userver_en" rel="noopener" id='telegram_channel' target="_blank" class="titlelink generic_tg_link">
              <img src="../../telegram_logo.svg" alt="Telegram"/>
          </a>
      `
      document.getElementById('main-navbar').appendChild(links);
  }
  $(function() {
    $(document).ready(function() {
      setTimeout(() => {
      init_all_results_button();
      init_search_hotkey();
      init_header();
      addLinks();
      changeTelegramChannelLanguageForRussianSpeakingUser();
      document.getElementById("side-nav").style.display = "none";
      const isLanding = document.getElementById('landing_logo_id') !== null;
      if (isLanding) return;
      highlight_code();
      styleNavButtons();
    }, 0);
    });
  });
</script>
<script type="module" src="../../toc.js"></script>
</body>
</html>
