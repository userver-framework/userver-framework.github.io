<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <!-- Yandex.Metrika counter -->
      <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(94541714, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
      </script>
      <noscript><div><img src="https://mc.yandex.ru/watch/94541714" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
      <!-- /Yandex.Metrika counter -->
      <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=9"/>
      <meta name="generator" content="Doxygen 1.10.0"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:image" content="../../logo_in_circle.png"/>
      <meta property="og:image:alt" content="userver logo"/>
      <link rel="icon" href="../../favicon.svg">
      <title>userver: uPg: Supported data types</title>
      <!-- Roboto fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <!-- Roboto fonts -->
      <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="../../jquery.js"></script>
      <!-- Highlight.js -->
      <link rel="stylesheet" href="../../highlightjs.css">
      <script src="../../highlight.min.js"></script>
      <!-- Highlight.js -->
      <!-- Roboto fonts -->
      <script type="text/javascript" src="../../dynsections.js"></script>
      <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
      <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
      <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
      <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
      <link rel="stylesheet" href="../../customdoxygen.css">
      <!-- Doxygen Awesome -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
      <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
        DoxygenAwesomeParagraphLink.init()
        DoxygenAwesomeInteractiveToc.topOffset = 180;
      </script>
      <!-- Doxygen Awesome -->
    </head>
    <body>
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0" style="width: 100%;">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
                <td id="projectalign">
                  <div id="projectname">
                    <a class="titlelink" href="../../index.html">userver
                    </a>
                  </div>
                  <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework</a></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dd/dad/md_en_2userver_2pg__types.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">uPg: Supported data types</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md441"></a> PostgreSQL provides data type support with a system of buffer parsers and formatters. Please refer to pg_io for more information about the system.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d9/dab/group__userver__postgres__parse__and__format.html">Postgres parsers and formatters</a></dd></dl>
<p><a class="anchor" id="pg_user_types"></a></p>
<h1><a class="anchor" id="autotoc_md442"></a>
Fundamental PostgreSQL types</h1>
<p>The fundamental PostgreSQL types support is provided by the driver. The table below shows supported PostgreSQL types and their mapping to C++ types provided by the driver. Column "Default" marks the PostgreSQL type to which a C++ type is mapped when used as a parameter. Where the C++ type is N/A it means that the PostgreSQL data type is not supported. When there is a C++ type in parenthesis, it is a data type that will be supported later and the C++ type is planned counterpart. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">PG type   </th><th class="markdownTableHeadNone">C++ type   </th><th class="markdownTableHeadNone">Default    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">smallint   </td><td class="markdownTableBodyNone">std::int16_t   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">integer   </td><td class="markdownTableBodyNone">std::int32_t   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bigint   </td><td class="markdownTableBodyNone">std::int64_t   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">smallserial   </td><td class="markdownTableBodyNone">std::int16_t   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">serial   </td><td class="markdownTableBodyNone">std::int32_t   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">bigserial   </td><td class="markdownTableBodyNone">std::int64_t   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">boolean   </td><td class="markdownTableBodyNone">bool   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">real   </td><td class="markdownTableBodyNone">float   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">double precision   </td><td class="markdownTableBodyNone">double   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">numeric(p)   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/dec/classdecimal64_1_1Decimal.html" title="Fixed-point decimal data type for use in deterministic calculations, oftentimes involving money.">decimal64::Decimal</a>   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">decimal(p)   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/dec/classdecimal64_1_1Decimal.html" title="Fixed-point decimal data type for use in deterministic calculations, oftentimes involving money.">decimal64::Decimal</a>   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">money   </td><td class="markdownTableBodyNone">N/A   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">text   </td><td class="markdownTableBodyNone">std::string   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">char(n)   </td><td class="markdownTableBodyNone">std::string   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">varchar(n)   </td><td class="markdownTableBodyNone">std::string   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">"char"   </td><td class="markdownTableBodyNone">char   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">timestamp   </td><td class="markdownTableBodyNone"><a class="el" href="../../de/d03/structstorages_1_1postgres_1_1TimePointWithoutTz.html" title="Corresponds to TIMESTAMP WITHOUT TIME ZONE database type.">storages::postgres::TimePointWithoutTz</a>   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">timestamptz   </td><td class="markdownTableBodyNone"><a class="el" href="../../d7/dde/structstorages_1_1postgres_1_1TimePointTz.html" title="Corresponds to TIMESTAMP WITH TIME ZONE database type.">storages::postgres::TimePointTz</a>   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">date   </td><td class="markdownTableBodyNone"><a class="el" href="../../dd/d34/classutils_1_1datetime_1_1Date.html" title="Date in format YYYY-MM-DD, std::chrono::year_month_day like type.">utils::datetime::Date</a>   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">time   </td><td class="markdownTableBodyNone"><a class="el" href="../../d8/d0d/classutils_1_1datetime_1_1TimeOfDay.html" title="A simple implementation of a &quot;time since midnight&quot; datatype.">utils::datetime::TimeOfDay</a>   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">timetz   </td><td class="markdownTableBodyNone">N/A   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">interval   </td><td class="markdownTableBodyNone">std::chrono::microseconds   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bytea   </td><td class="markdownTableBodyNone">container of one-byte type   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="3">bit(n)   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/d8b/classutils_1_1Flags.html" title="Wrapper to extend enum with flags interface.">utils::Flags</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">std::bitset&lt;N&gt;   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">std::array&lt;bool, N&gt;   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="3">bit varying(n)   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/d8b/classutils_1_1Flags.html" title="Wrapper to extend enum with flags interface.">utils::Flags</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">std::bitset&lt;N&gt;   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">std::array&lt;bool, N&gt;   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">uuid   </td><td class="markdownTableBodyNone">boost::uuids::uuid   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">json   </td><td class="markdownTableBodyNone"><a class="el" href="../../de/d91/classformats_1_1json_1_1Value.html" title="Non-mutable JSON value representation.">formats::json::Value</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">jsonb   </td><td class="markdownTableBodyNone"><a class="el" href="../../de/d91/classformats_1_1json_1_1Value.html" title="Non-mutable JSON value representation.">formats::json::Value</a>   </td><td class="markdownTableBodyNone">+    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="2">int4range   </td><td class="markdownTableBodyNone">storages::postgres::IntegerRange   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">storages::postgres::BoundedIntegerRange   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="2">int8range   </td><td class="markdownTableBodyNone">storages::postgres::BigintRange   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">storages::postgres::BoundedBigintRange   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="2">inet   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/d2e/group__userver__containers.html#gaa9e95b0e36b2c69c33933f4256b98090" title="IPv4 address in network bytes order.">utils::ip::AddressV4</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="../../df/d2e/group__userver__containers.html#ga9a7d107944e71384a7dd68fe2395d045" title="IPv6 address in network bytes order.">utils::ip::AddressV6</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="2">cidr   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/d2e/group__userver__containers.html#ga99975c78fd19b80bf5128705eac9b5b8" title="IPv4 network.">utils::ip::NetworkV4</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="../../df/d2e/group__userver__containers.html#ga6d31a0f5961f646252f22db093727ba4" title="IPv6 network.">utils::ip::NetworkV6</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">macaddr   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/d2e/group__userver__containers.html#gadf14b0d238bb06075cbfa251cf6730c3" title="48-bit MAC address">utils::Macaddr</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">macaddr8   </td><td class="markdownTableBodyNone"><a class="el" href="../../df/d2e/group__userver__containers.html#ga450a26431021b7c87981be7f7af9084f" title="64-bit MAC address">utils::Macaddr8</a>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">numrange   </td><td class="markdownTableBodyNone">N/A   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">tsrange   </td><td class="markdownTableBodyNone">N/A   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">tstzrange   </td><td class="markdownTableBodyNone">N/A   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">daterange   </td><td class="markdownTableBodyNone">N/A   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<dl class="section warning"><dt>Warning</dt><dd>The library doesn't provide support for C++ unsigned integral types intentionally as PostgreSQL doesn't provide unsigned types and using the types with the database is error-prone.</dd></dl>
<p><a class="anchor" id="pg_timestamp"></a></p>
<h1><a class="anchor" id="autotoc_md443"></a>
Timestamp Support aka TimePointTz and TimePointWithoutTz</h1>
<p>The driver provides mapping from C++ std::chrono::time_point template type to Postgres timestamp (without time zone) data type.</p>
<p>To read/write timestamp with time zone Postgres data type a <a class="el" href="../../d7/dde/structstorages_1_1postgres_1_1TimePointTz.html" title="Corresponds to TIMESTAMP WITH TIME ZONE database type.">storages::postgres::TimePointTz</a> helper type is provided.</p>
<p>PostgreSQL internal timestamp resolution is microseconds.</p>
<p><b>Example:</b></p>
<div class="fragment"><div class="line">    <span class="keyword">namespace </span>pg = <a class="code hl_namespace" href="../../de/d6d/namespacestorages_1_1postgres.html" title="Top namespace for uPg driver.">storages::postgres</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Postgres only supports microsecond resolution</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> now = std::chrono::time_point_cast&lt;std::chrono::microseconds&gt;(std::chrono::system_clock::now());</div>
<div class="line"> </div>
<div class="line">    connection-&gt;Execute(R<span class="stringliteral">&quot;(</span></div>
<div class="line"><span class="stringliteral">    CREATE TABLE tz_sample(</span></div>
<div class="line"><span class="stringliteral">      with_tz     TIMESTAMP WITH    TIME ZONE,</span></div>
<div class="line"><span class="stringliteral">      without_tz  TIMESTAMP WITHOUT TIME ZONE</span></div>
<div class="line"><span class="stringliteral">    )</span></div>
<div class="line"><span class="stringliteral">  )&quot;);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    </span><span class="comment">// No conversion performed</span></div>
<div class="line">    <span class="keyword">constexpr</span> <span class="keyword">auto</span> kInsertQuery = R<span class="stringliteral">&quot;(</span></div>
<div class="line"><span class="stringliteral">    INSERT INTO tz_sample(with_tz, without_tz) VALUES($1, $2)</span></div>
<div class="line"><span class="stringliteral">    RETURNING with_tz, without_tz</span></div>
<div class="line"><span class="stringliteral">  )&quot;;</span></div>
<div class="line"><span class="stringliteral">    </span><span class="keyword">const</span> <span class="keyword">auto</span> res = connection-&gt;Execute(kInsertQuery, pg::TimePointTz{now}, pg::TimePointWithoutTz{now});</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Both values contain the correct time point</span></div>
<div class="line">    EXPECT_EQ(res[0][0].As&lt;pg::TimePointTz&gt;().GetUnderlying(), now);</div>
<div class="line">    EXPECT_EQ(res[0][1].As&lt;pg::TimePointWithoutTz&gt;().GetUnderlying(), now);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md444"></a>
How not to get skewed times in the PostgreSQL</h2>
<p>Postgres has two types corresponding to absolute time (a.k.a. global time; Unix time; NOT local time):</p><ul>
<li><code>TIMESTAMP WITH TIME ZONE</code></li>
<li><code>TIMESTAMP</code></li>
</ul>
<p>An unfortunate design decision on the PostgreSQL side is that it allows <b>implicit conversion</b> between them, and database applies an offset to the time point when doing so, depending on the timezone of the Postgres database.</p>
<p>Because of this you MUST ensure that you always use the correct type:</p><ul>
<li><a class="el" href="../../d7/dde/structstorages_1_1postgres_1_1TimePointTz.html" title="Corresponds to TIMESTAMP WITH TIME ZONE database type.">storages::postgres::TimePointTz</a> for <code>TIMESTAMP WITH TIME ZONE</code>;</li>
<li><a class="el" href="../../de/d03/structstorages_1_1postgres_1_1TimePointWithoutTz.html" title="Corresponds to TIMESTAMP WITHOUT TIME ZONE database type.">storages::postgres::TimePointWithoutTz</a> for <code>TIMESTAMP</code>.</li>
</ul>
<p>Otherwise, you'll get skewed times in database:</p>
<div class="fragment"><div class="line">    <span class="keyword">namespace </span>pg = <a class="code hl_namespace" href="../../de/d6d/namespacestorages_1_1postgres.html" title="Top namespace for uPg driver.">storages::postgres</a>;</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> tz_offset_res = connection-&gt;Execute(<span class="stringliteral">&quot;select extract(timezone from now())::integer&quot;</span>);</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> tz_offset = std::chrono::seconds{tz_offset_res[0].As&lt;<span class="keywordtype">int</span>&gt;()};</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> now = std::chrono::time_point_cast&lt;std::chrono::microseconds&gt;(std::chrono::system_clock::now());</div>
<div class="line">    connection-&gt;Execute(R<span class="stringliteral">&quot;(</span></div>
<div class="line"><span class="stringliteral">    CREATE TABLE tz_conversion_sample(</span></div>
<div class="line"><span class="stringliteral">      with_tz    TIMESTAMP WITH    TIME ZONE,</span></div>
<div class="line"><span class="stringliteral">      without_tz TIMESTAMP WITHOUT TIME ZONE</span></div>
<div class="line"><span class="stringliteral">    )</span></div>
<div class="line"><span class="stringliteral">  )&quot;);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">    </span><span class="keyword">constexpr</span> <span class="keyword">auto</span> kInsertQuery = R<span class="stringliteral">&quot;(</span></div>
<div class="line"><span class="stringliteral">    INSERT INTO tz_conversion_sample(with_tz, without_tz) VALUES($1, $2)</span></div>
<div class="line"><span class="stringliteral">    RETURNING with_tz, without_tz</span></div>
<div class="line"><span class="stringliteral">  )&quot;;</span></div>
<div class="line"><span class="stringliteral">    </span><span class="comment">// ERROR! Types missmatch and are implicitly converted:</span></div>
<div class="line">    <span class="comment">// * TimePointWithoutTz is converted on the DB side and TZ substracted.</span></div>
<div class="line">    <span class="comment">// * TimePointTz is converted on the DB side and TZ added.</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> res = connection-&gt;Execute(kInsertQuery, pg::TimePointWithoutTz{now}, pg::TimePointTz{now});</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Both values were skewed</span></div>
<div class="line">    <span class="keyword">using </span>time_point = std::chrono::system_clock::time_point;</div>
<div class="line">    EXPECT_EQ(res[0][0].As&lt;time_point&gt;() + tz_offset, now);</div>
<div class="line">    EXPECT_EQ(res[0][1].As&lt;time_point&gt;() - tz_offset, now);</div>
</div><!-- fragment --><p>There is no way to detect that issue on the userver side, as the implicit conversion is performed by the database itself and it provides no information that the conversion happened.</p>
<p><a class="anchor" id="pg_arrays"></a></p>
<h1><a class="anchor" id="autotoc_md445"></a>
Arrays in PostgreSQL</h1>
<p>The driver supports PostgreSQL arrays provided that the element type is supported by the driver, including user types.</p>
<p>Array parser will throw <a class="el" href="../../d7/d98/classstorages_1_1postgres_1_1DimensionMismatch.html" title="Array received from postgres has different dimensions from those of C++ container.">storages::postgres::DimensionMismatch</a> if the dimensions of C++ container do not match that of the buffer received from the server.</p>
<p>Array formatter will throw <a class="el" href="../../da/d07/classstorages_1_1postgres_1_1InvalidDimensions.html">storages::postgres::InvalidDimensions</a> if containers on same level of depth have different sizes.</p>
<h1><a class="anchor" id="autotoc_md446"></a>
User-defined PostgreSQL types</h1>
<p>The driver provides support for user-defined PostgreSQL types:</p><ul>
<li>domains</li>
<li>enumerations</li>
<li>composite types</li>
<li>custom ranges</li>
</ul>
<p>For more information please see <a class="el" href="../../df/d47/md_en_2userver_2pg__user__types.html">uPg: PostgreSQL user type mappings</a>.</p>
<h1><a class="anchor" id="autotoc_md447"></a>
C++ strong typedefs in PostgreSQL</h1>
<p>The driver provides support for C++ strong typedef idiom. For more information see <a class="el" href="../../d3/ddf/pg_strong_typedef.html">uPg: support for C++ 'strong typedef' idiom</a></p>
<h1><a class="anchor" id="autotoc_md448"></a>
PostgreSQL ranges</h1>
<p>PostgreSQL range type support is provided by <code><a class="el" href="../../d1/df6/classstorages_1_1postgres_1_1Range.html">storages::postgres::Range</a></code> template.</p>
<h1><a class="anchor" id="autotoc_md449"></a>
Geometry types in PostgreSQL</h1>
<p>For geometry types the driver provides parsing/formatting from/to on-the-wire representation. The types provided do not define any calculus.</p>
<p><a class="anchor" id="pg_bytea"></a></p>
<h1><a class="anchor" id="autotoc_md450"></a>
PostgreSQL bytea support</h1>
<p>The driver allows reading and writing raw binary data from/to PostgreSQL <code>bytea</code> type.</p>
<p>Reading and writing to PostgreSQL is implemented for <code>std::string</code>, <code>std::string_view</code> and <code>std::vector</code> of <code>char</code> or <code>unsigned char</code>.</p>
<dl class="section warning"><dt>Warning</dt><dd>When reading to <code>std::string_view</code> the value MUST NOT be used after the PostgreSQL result set is destroyed.</dd></dl>
<p>Bytea() is a helper function for reading and writing binary data from/to a database.</p>
<p>Example usage of Bytea(): </p><div class="fragment"><div class="line">        pg::ResultSet res = GetConn()-&gt;Execute(<span class="stringliteral">&quot;select &#39;foobar&#39;::bytea&quot;</span>);</div>
<div class="line">        std::string s = <span class="stringliteral">&quot;foobar&quot;</span>s;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// reading a binary string</span></div>
<div class="line">        std::string received;</div>
<div class="line">        res[0][0].To(pg::Bytea(received));</div>
<div class="line">        EXPECT_EQ(received, s);</div>
</div><!-- fragment --> <div class="fragment"><div class="line">        <span class="comment">// sending a binary string</span></div>
<div class="line">        std::string s = <span class="stringliteral">&quot;\0\xff\x0afoobar&quot;</span>s;</div>
<div class="line">        pg::ResultSet res = GetConn()-&gt;Execute(<span class="stringliteral">&quot;select $1&quot;</span>, pg::Bytea(s));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// reading a binary string</span></div>
<div class="line">        std::string received;</div>
<div class="line">        res[0][0].To(pg::Bytea(received));</div>
<div class="line">        EXPECT_EQ(received, s);</div>
</div><!-- fragment --> <div class="fragment"><div class="line">        <span class="comment">// storing a byte vector:</span></div>
<div class="line">        std::vector&lt;std::uint8_t&gt; bin_str{1, 2, 3, 4, 5, 6, 7, 8, 9};</div>
<div class="line">        <span class="keyword">auto</span> res = GetConn()-&gt;Execute(<span class="stringliteral">&quot;select $1&quot;</span>, pg::Bytea(bin_str));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// reading a byte vector</span></div>
<div class="line">        std::vector&lt;std::uint8_t&gt; received;</div>
<div class="line">        res[0][0].To(pg::Bytea(received));</div>
<div class="line">        EXPECT_EQ(received, bin_str);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md451"></a>
Network types in PostgreSQL</h1>
<p>The driver offers data types to store IPv4, IPv6, and MAC addresses, as well as network specifications (CIDR).</p>
<h1><a class="anchor" id="autotoc_md452"></a>
Bit string types in PostgreSQL</h1>
<p>The driver supports PostgreSQL <code>bit</code> and <code>bit varying</code> types.</p>
<p>Parsing and formatting is implemented for integral values (e.g. <code>uint32_t</code>, <code>uint64_t</code>), <code><a class="el" href="../../df/d8b/classutils_1_1Flags.html" title="Wrapper to extend enum with flags interface.">utils::Flags</a></code>, <code>std::array&lt;bool, N&gt;</code> and <code>std::bitset&lt;N&gt;</code>.</p>
<p>Example of using the bit types from tests: </p><div class="fragment"><div class="line">    res = conn-&gt;Execute(<span class="stringliteral">&quot;select 25::bit(8)&quot;</span>);</div>
<div class="line">    <span class="keyword">auto</span> bits = res[0][0].As&lt;std::bitset&lt;8&gt;&gt;();</div>
<div class="line">    EXPECT_EQ(bits, 0b11001);</div>
<div class="line"> </div>
<div class="line">    res = conn-&gt;Execute(<span class="stringliteral">&quot;select $1::text&quot;</span>, bits);</div>
<div class="line">    EXPECT_EQ(res[0][0].As&lt;std::string&gt;(), <span class="stringliteral">&quot;00011001&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    std::uint8_t num{};</div>
<div class="line">    res = conn-&gt;Execute(<span class="stringliteral">&quot;select 42::bit(8)&quot;</span>);</div>
<div class="line">    res[0][0].To(pg::Bit(num));</div>
<div class="line">    EXPECT_EQ(num, 42);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md453"></a>
PostgreSQL types not covered above</h1>
<p>The types not covered above or marked as N/A in the table of fundamental types will be eventually supported later, on request from the driver's users.</p>
<hr  />
<p> <div class="bottom-nav">  ⇦ <a class="el" href="../../db/db5/pg_process_results.html">uPg: Working with result sets</a> | <a class="el" href="../../d2/d2f/pg_user_row_types.html">uPg: Typed PostgreSQL results</a> ⇨  </div>  </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Oct 21 2024 13:55:59 for userver by
    <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.10.0</li>
  </ul>
</div>
<script type="text/javascript" src="../../codeHighlight.js"></script>
<script type="text/javascript" src="../../telegramLanguage.js"></script>
<script type="text/javascript" src="../../styledBtn.js"></script>
<script type="text/javascript" src="../../search.js"></script>
<script type="text/javascript" src="../../header.js"></script>
<script type="text/javascript" src="../../searchHighlight.js"></script>
<script>
  const addLinks = () =>  {
      const links = document.createElement('div')
      links.id = 'links';
      links.innerHTML = `
          <a href="https://github.com/userver-framework/" id='github_header' rel="noopener" target="_blank" class="titlelink">
              <img src="../../github_logo.svg" alt="Github" class="gh-logo"/>
          </a>
          <a href="https://t.me/userver_en" rel="noopener" id='telegram_channel' target="_blank" class="titlelink generic_tg_link">
              <img src="../../telegram_logo.svg" alt="Telegram"/>
          </a>
      `
      document.getElementById('main-navbar').appendChild(links);
  }
  $(function() {
    $(document).ready(function() {
      setTimeout(() => {
      init_all_results_button();
      init_search_hotkey();
      init_header();
      addLinks();
      changeTelegramChannelLanguageForRussianSpeakingUser();
      document.getElementById("side-nav").style.display = "none";
      const isLanding = document.getElementById('landing_logo_id') !== null;
      if (isLanding) return;
      highlight_code();
      styleNavButtons();
    }, 0);
    });
  });
</script>
<script type="module" src="../../toc.js"></script>
</body>
</html>
